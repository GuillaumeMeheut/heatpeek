(()=>{let s=document.currentScript.getAttribute("id"),e="https://heatpeek.com",d="https://api.heatpeek.com";if(!s)return;if((()=>{let t=navigator.userAgent.toLowerCase();return["bot","crawler","spider","headless","selenium","googlebot","bingbot","yandexbot","duckduckbot","baiduspider","lighthouse","webdriver","phantomjs","puppeteer","playwright","nmap","nikto","acunetix","nessus","burp","zap","curl","wget","python-requests","java-http-client","pingdom","uptimerobot","newrelic","datadog","facebookexternalhit","twitterbot","linkedinbot","apache-httpclient","python-urllib","java-http-client","mozilla/5.0 (compatible;)","mozilla/5.0 (bot;)","mozilla/5.0 (crawler;)","mozilla/5.0 (spider;)","mozilla/5.0 (monitoring;)"].some(e=>t.includes(e))})())return;(async(e,t)=>{new URLSearchParams(window.location.search).get("verifyHp")===t&&fetch(e+"/api/verify/"+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({verified:!0})}).then(()=>{window.close()}).catch(e=>{console.error(e)})})(e,s);let g={data:null,lastFetch:0,CACHE_DURATION:6e4,async fetch(){var e=Date.now();if(this.data&&e-this.lastFetch<this.CACHE_DURATION)return this.data;try{var t=await fetch(d+`/api/project/config?id=${s}&p=`+window.location.pathname);if(t.ok)return this.data=await t.json(),this.lastFetch=e,this.data;throw new Error("Failed to fetch config")}catch(e){return console.error("Heatpeek: Error fetching config:",e),null}},get(){return this.data}},f=(g.fetch().then(o=>{if(o){let a=(()=>{const e=window.innerWidth,t=768,n=1024,i=1920;return e<=t?"mobile":e<=n?"tablet":e<=i?"desktop":"large-desktop"})();if((e=>"large-desktop"!==e&&!1!==(e=g.get()).page_config.is_active)(a)){let t=window.location.pathname,n=(()=>{let e=navigator.userAgent,t=null;return!/Chrome/.test(e)||/Edge/.test(e)||/OPR/.test(e)?/Safari/.test(e)&&!/Chrome/.test(e)?t="Safari":/Firefox/.test(e)?t="Firefox":/Edg/.test(e)&&(t="Edge"):t="Chrome",t})(),l=0,c=0,h=new Map,p=[];let i;window.addEventListener("hashchange",function(){r(!0)});o=window.history;if(o.pushState){let e=o.pushState;o.pushState=function(){e.apply(this,arguments),r(!0)},window.addEventListener("popstate",function(){r(!0)})}function r(e){var t=location.pathname;e&&i===t||(i=t,c=0,h.clear())}function u(){var e;0!==p.length&&(e=JSON.stringify({trackingId:s,path:t,device:a,browser:n,events:p.splice(0,p.length)}),navigator.sendBeacon?navigator.sendBeacon(d+"/api/event/events",e):fetch(d+"/api/event/events",{method:"POST",headers:{"Content-Type":"application/json"},body:e}).catch(e=>{console.error("Heatpeek: Error sending event data:",e)}))}"hidden"===document.visibilityState||"prerender"===document.visibilityState?document.addEventListener("visibilitychange",function(){i||"visible"!==document.visibilityState||r(!1)}):r(!1),window.addEventListener("pageshow",function(e){e.persisted&&r(!1)}),setInterval(u,5e3),window.addEventListener("beforeunload",u),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&u()}),document.addEventListener("click",e=>{var t=Date.now();if(!(t-l<500)){l=t;for(var n=e.target,i=n.getBoundingClientRect(),a=Math.round(i.left+window.scrollX),o=Math.round(i.top+window.scrollY),r=Math.round(i.width),i=Math.round(i.height),n=(t=>{if(t.id)return"#"+CSS.escape(t.id);for(var n=[];t&&t.nodeType===Node.ELEMENT_NODE;){let e=t.nodeName.toLowerCase();t.className&&(a=Array.from(t.classList).map(e=>"."+CSS.escape(e)).join(""),e+=a);var i,a=t.parentElement;a&&1<(i=Array.from(a.children).filter(e=>e.tagName===t.tagName)).length&&(i=i.indexOf(t)+1,e+=`:nth-of-type(${i})`),n.unshift(e),t=t.parentElement}var e=n.join(" > ");{var o=e;let t=0;for(let e=0;e<o.length;e++){var r=o.charCodeAt(e);t=(t<<5)-t+r,t&=t}return Math.abs(t).toString(36).substring(0,8)}})(n),a=(e.pageX-a)/r,r=(e.pageY-o)/i,s=(h.has(n)||h.set(n,[]),h.get(n)),d=(s.push(t),t-1500);0<s.length&&s[0]<d;)s.shift();e=3<=s.length,o=(console.log(`Heatpeek: Click on ${n}, count: ${s.length}, isRageClick: `+e),{timestamp:(new Date).toISOString(),selector:n,erx:a,ery:r});e?(i={...o,type:"rage_click"},p.push(i)):(t={...o,type:"click",firstClickRank:c<3?c+1:null},p.push(t)),c++,10<=p.length&&u()}}),window.addEventListener("load",()=>{setTimeout(()=>{"Chrome"===n&&g.get().page_config[f[a]]&&fetch(e+"/api/screenPage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trackingId:s,device:a,url:window.location.href,snapshot:(()=>{var e=document.documentElement.outerHTML,t={width:window.innerWidth,height:window.innerHeight};return{html:e,viewport:t}})()})})},2500)})}}else console.error("Heatpeek: Failed to load configuration")}),{desktop:"update_snap_desktop",tablet:"update_snap_tablet",mobile:"update_snap_mobile"})})();