function getBrowserName(){var e=navigator.userAgent;let t="Unknown";return/Arc/.test(e)?t="Arc":!/Chrome/.test(e)||/Edge/.test(e)||/OPR/.test(e)?/Firefox/.test(e)?t="Firefox":/Safari/.test(e)&&!/Chrome/.test(e)?t="Safari":/Edg/.test(e)?t="Edge":/OPR/.test(e)&&(t="Opera"):t="Chrome",t}async function verifyTracking(e,t){new URLSearchParams(window.location.search).get("verifyHp")===t&&fetch(e+"/api/verify/"+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({verified:!0})}).then(()=>{window.close()}).catch(e=>{console.error(e)})}function getViewportDeviceCategory(){var e=window.innerWidth;const t=768,n=1024,o=1920;return e<=t?"mobile":e<=n?"tablet":e<=o?"desktop":"large-desktop"}function getUniqueSelector(t){if(t.id)return"#"+CSS.escape(t.id);for(var n=[];t&&t.nodeType===Node.ELEMENT_NODE;){let e=t.nodeName.toLowerCase();t.className&&(i=Array.from(t.classList).map(e=>"."+CSS.escape(e)).join(""),e+=i);var o,i=t.parentElement;i&&1<(o=Array.from(i.children).filter(e=>e.tagName===t.tagName)).length&&(o=o.indexOf(t)+1,e+=`:nth-of-type(${o})`),n.unshift(e),t=t.parentElement}return generateShortHash(n.join(" > "))}function generateShortHash(t){let n=0;for(let e=0;e<t.length;e++){var o=t.charCodeAt(e);n=(n<<5)-n+o,n&=n}return Math.abs(n).toString(36).substring(0,8)}function detectBot(){let t=navigator.userAgent.toLowerCase();return["bot","crawler","spider","headless","selenium","googlebot","bingbot","yandexbot","duckduckbot","baiduspider","lighthouse","webdriver","phantomjs","puppeteer","playwright","nmap","nikto","acunetix","nessus","burp","zap","curl","wget","python-requests","java-http-client","pingdom","uptimerobot","newrelic","datadog","facebookexternalhit","twitterbot","linkedinbot","apache-httpclient","python-urllib","java-http-client","mozilla/5.0 (compatible;)","mozilla/5.0 (bot;)","mozilla/5.0 (crawler;)","mozilla/5.0 (spider;)","mozilla/5.0 (monitoring;)"].some(e=>t.includes(e))}(()=>{let s=document.currentScript.getAttribute("id"),p="https://heatpeek.com";if(s&&!detectBot()){verifyTracking(p,s);let e={data:null,lastFetch:0,CACHE_DURATION:6e4,async fetch(){var e=Date.now();if(this.data&&e-this.lastFetch<this.CACHE_DURATION)return this.data;try{var t=await fetch(`https://api.heatpeek.com/?id=${s}&p=`+window.location.pathname);if(t.ok)return this.data=await t.json(),this.lastFetch=e,this.data;throw new Error("Failed to fetch config")}catch(e){return console.error("Heatpeek: Error fetching config:",e),null}},get(){return this.data}};e.fetch().then(i=>{if(i){let o=getViewportDeviceCategory();if("large-desktop"!==o){console.log("config",e.get());let t=window.location.pathname,c=0,l=0,d=[];let n;window.addEventListener("hashchange",function(){a(!0)});i=window.history;if(i.pushState){let e=i.pushState;i.pushState=function(){e.apply(this,arguments),a(!0)},window.addEventListener("popstate",function(){a(!0)})}function a(e){var t=location.pathname;e&&n===t||(n=t,l=0)}function h(){var e;0!==d.length&&(e=JSON.stringify({trackingId:s,url:t,device:o,events:d.splice(0,d.length)}),navigator.sendBeacon?navigator.sendBeacon(p+"/api/e",e):fetch(p+"/api/e",{method:"POST",headers:{"Content-Type":"application/json"},body:e}).catch(e=>{console.error("Heatpeek: Error sending click data:",e)}))}function r(){let e="";for(var t of Array.from(document.styleSheets))try{for(var n of t.cssRules)e+=n.cssText+"\n"}catch(e){}return e}"hidden"===document.visibilityState||"prerender"===document.visibilityState?document.addEventListener("visibilitychange",function(){n||"visible"!==document.visibilityState||a(!1)}):a(!1),window.addEventListener("pageshow",function(e){e.persisted&&a(!1)}),setInterval(h,5e3),window.addEventListener("beforeunload",h),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&h()}),document.addEventListener("click",e=>{var t,n,o,i,a,r,s=Date.now();s-c<500||(c=s,i=(s=e.target).getBoundingClientRect(),t=Math.round(i.left+window.scrollX),n=Math.round(i.top+window.scrollY),o=Math.round(i.width),i=Math.round(i.height),r=!!(s.offsetWidth||s.offsetHeight||s.getClientRects().length),s=getUniqueSelector(s),a=(e.pageX-t)/o,e=(e.pageY-n)/i,r={timestamp:(new Date).toISOString(),visible:r,erx:a,ery:e,s:s,l:t,t:n,w:o,h:i,firstClickRank:l<3?l+1:null},d.push(r),l++,10<=d.length&&h())}),document.addEventListener("DOMContentLoaded",()=>{requestAnimationFrame(()=>{setTimeout(()=>{console.log("shouldSendSnapshot"),"Chrome"===getBrowserName()&&(console.log("config",e.get()),e.get().page_config.update_snap)&&(console.log("sendSnapshot"),fetch(p+"/api/screenPage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trackingId:s,url:window.location.href,device:o,snapshot:(()=>{var e=document.documentElement.outerHTML,t={width:window.innerWidth,height:window.innerHeight};return console.log("captureHeatpeekSnapshot",{html:e,viewport:t,styles:r()}),{html:e,viewport:t,styles:r()}})()})}))},2e3)})})}}else console.error("Heatpeek: Failed to load configuration")})}})();