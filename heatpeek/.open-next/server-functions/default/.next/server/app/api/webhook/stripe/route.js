(()=>{var e={};e.id=310,e.ids=[310],e.modules={41919:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=41919,e.exports=t},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},35900:e=>{"use strict";e.exports=require("pg")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},92048:e=>{"use strict";e.exports=require("fs")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},55315:e=>{"use strict";e.exports=require("path")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},8678:e=>{"use strict";e.exports=import("pg")},58359:()=>{},93739:()=>{},36556:(e,t,r)=>{"use strict";r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>c,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>h});var s=r(49303),n=r(88716),o=r(60670),a=r(98102),l=e([a]);a=(l.then?(await l)():l)[0];let u=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/webhook/stripe/route",pathname:"/api/webhook/stripe",filename:"route",bundlePath:"app/api/webhook/stripe/route"},resolvedPagePath:"/Users/guillaume/Documents/perso/heatpeek-project/heatpeek/src/app/api/webhook/stripe/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:p}=u,m="/api/webhook/stripe/route";function c(){return(0,o.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:h})}i()}catch(e){i(e)}})},81421:(e,t,r)=>{"use strict";var i=r(31660),s=r(34006),n=r(43135),o=r(53659);e.exports=o||i.call(n,s)},34006:e=>{"use strict";e.exports=Function.prototype.apply},43135:e=>{"use strict";e.exports=Function.prototype.call},602:(e,t,r)=>{"use strict";var i=r(31660),s=r(17445),n=r(43135),o=r(81421);e.exports=function(e){if(e.length<1||"function"!=typeof e[0])throw new s("a function is required");return o(i,n,e)}},53659:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect&&Reflect.apply},98363:(e,t,r)=>{"use strict";var i=r(2749),s=r(602),n=s([i("%String.prototype.indexOf%")]);e.exports=function(e,t){var r=i(e,!!t);return"function"==typeof r&&n(e,".prototype.")>-1?s([r]):r}},62344:(e,t,r)=>{"use strict";var i,s=r(602),n=r(86737);try{i=[].__proto__===Array.prototype}catch(e){if(!e||"object"!=typeof e||!("code"in e)||"ERR_PROTO_ACCESS"!==e.code)throw e}var o=!!i&&n&&n(Object.prototype,"__proto__"),a=Object,l=a.getPrototypeOf;e.exports=o&&"function"==typeof o.get?s([o.get]):"function"==typeof l&&function(e){return l(null==e?e:a(e))}},70091:e=>{"use strict";var t=Object.defineProperty||!1;if(t)try{t({},"a",{value:1})}catch(e){t=!1}e.exports=t},86827:e=>{"use strict";e.exports=EvalError},56718:e=>{"use strict";e.exports=Error},37388:e=>{"use strict";e.exports=RangeError},63684:e=>{"use strict";e.exports=ReferenceError},31209:e=>{"use strict";e.exports=SyntaxError},17445:e=>{"use strict";e.exports=TypeError},76928:e=>{"use strict";e.exports=URIError},15678:e=>{"use strict";e.exports=Object},49214:e=>{"use strict";var t=Object.prototype.toString,r=Math.max,i=function(e,t){for(var r=[],i=0;i<e.length;i+=1)r[i]=e[i];for(var s=0;s<t.length;s+=1)r[s+e.length]=t[s];return r},s=function(e,t){for(var r=[],i=t||0,s=0;i<e.length;i+=1,s+=1)r[s]=e[i];return r},n=function(e,t){for(var r="",i=0;i<e.length;i+=1)r+=e[i],i+1<e.length&&(r+=t);return r};e.exports=function(e){var o,a=this;if("function"!=typeof a||"[object Function]"!==t.apply(a))throw TypeError("Function.prototype.bind called on incompatible "+a);for(var l=s(arguments,1),c=r(0,a.length-l.length),u=[],d=0;d<c;d++)u[d]="$"+d;if(o=Function("binder","return function ("+n(u,",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof o){var t=a.apply(this,i(l,arguments));return Object(t)===t?t:this}return a.apply(e,i(l,arguments))}),a.prototype){var h=function(){};h.prototype=a.prototype,o.prototype=new h,h.prototype=null}return o}},31660:(e,t,r)=>{"use strict";var i=r(49214);e.exports=Function.prototype.bind||i},2749:(e,t,r)=>{"use strict";var i,s=r(15678),n=r(56718),o=r(86827),a=r(37388),l=r(63684),c=r(31209),u=r(17445),d=r(76928),h=r(95175),p=r(22334),m=r(46082),f=r(40430),y=r(24210),g=r(70792),v=r(92615),_=Function,P=function(e){try{return _('"use strict"; return ('+e+").constructor;")()}catch(e){}},b=r(86737),T=r(70091),E=function(){throw new u},S=b?function(){try{return arguments.callee,E}catch(e){try{return b(arguments,"callee").get}catch(e){return E}}}():E,w=r(91976)(),x=r(93941),O=r(67209),A=r(32395),k=r(34006),C=r(43135),R={},I="undefined"!=typeof Uint8Array&&x?x(Uint8Array):i,j={__proto__:null,"%AggregateError%":"undefined"==typeof AggregateError?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?i:ArrayBuffer,"%ArrayIteratorPrototype%":w&&x?x([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":R,"%AsyncGenerator%":R,"%AsyncGeneratorFunction%":R,"%AsyncIteratorPrototype%":R,"%Atomics%":"undefined"==typeof Atomics?i:Atomics,"%BigInt%":"undefined"==typeof BigInt?i:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?i:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":n,"%eval%":eval,"%EvalError%":o,"%Float16Array%":"undefined"==typeof Float16Array?i:Float16Array,"%Float32Array%":"undefined"==typeof Float32Array?i:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?i:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?i:FinalizationRegistry,"%Function%":_,"%GeneratorFunction%":R,"%Int8Array%":"undefined"==typeof Int8Array?i:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?i:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":w&&x?x(x([][Symbol.iterator]())):i,"%JSON%":"object"==typeof JSON?JSON:i,"%Map%":"undefined"==typeof Map?i:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&w&&x?x(new Map()[Symbol.iterator]()):i,"%Math%":Math,"%Number%":Number,"%Object%":s,"%Object.getOwnPropertyDescriptor%":b,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?i:Promise,"%Proxy%":"undefined"==typeof Proxy?i:Proxy,"%RangeError%":a,"%ReferenceError%":l,"%Reflect%":"undefined"==typeof Reflect?i:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?i:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&w&&x?x(new Set()[Symbol.iterator]()):i,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":w&&x?x(""[Symbol.iterator]()):i,"%Symbol%":w?Symbol:i,"%SyntaxError%":c,"%ThrowTypeError%":S,"%TypedArray%":I,"%TypeError%":u,"%Uint8Array%":"undefined"==typeof Uint8Array?i:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?i:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?i:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?i:Uint32Array,"%URIError%":d,"%WeakMap%":"undefined"==typeof WeakMap?i:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?i:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?i:WeakSet,"%Function.prototype.call%":C,"%Function.prototype.apply%":k,"%Object.defineProperty%":T,"%Object.getPrototypeOf%":O,"%Math.abs%":h,"%Math.floor%":p,"%Math.max%":m,"%Math.min%":f,"%Math.pow%":y,"%Math.round%":g,"%Math.sign%":v,"%Reflect.getPrototypeOf%":A};if(x)try{null.error}catch(e){var G=x(x(e));j["%Error.prototype%"]=G}var M=function e(t){var r;if("%AsyncFunction%"===t)r=P("async function () {}");else if("%GeneratorFunction%"===t)r=P("function* () {}");else if("%AsyncGeneratorFunction%"===t)r=P("async function* () {}");else if("%AsyncGenerator%"===t){var i=e("%AsyncGeneratorFunction%");i&&(r=i.prototype)}else if("%AsyncIteratorPrototype%"===t){var s=e("%AsyncGenerator%");s&&x&&(r=x(s.prototype))}return j[t]=r,r},D={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},N=r(31660),q=r(64995),$=N.call(C,Array.prototype.concat),U=N.call(k,Array.prototype.splice),F=N.call(C,String.prototype.replace),L=N.call(C,String.prototype.slice),H=N.call(C,RegExp.prototype.exec),W=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,z=/\\(\\)?/g,B=function(e){var t=L(e,0,1),r=L(e,-1);if("%"===t&&"%"!==r)throw new c("invalid intrinsic syntax, expected closing `%`");if("%"===r&&"%"!==t)throw new c("invalid intrinsic syntax, expected opening `%`");var i=[];return F(e,W,function(e,t,r,s){i[i.length]=r?F(s,z,"$1"):t||e}),i},K=function(e,t){var r,i=e;if(q(D,i)&&(i="%"+(r=D[i])[0]+"%"),q(j,i)){var s=j[i];if(s===R&&(s=M(i)),void 0===s&&!t)throw new u("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:r,name:i,value:s}}throw new c("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new u("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new u('"allowMissing" argument must be a boolean');if(null===H(/^%?[^%]*%?$/,e))throw new c("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=B(e),i=r.length>0?r[0]:"",s=K("%"+i+"%",t),n=s.name,o=s.value,a=!1,l=s.alias;l&&(i=l[0],U(r,$([0,1],l)));for(var d=1,h=!0;d<r.length;d+=1){var p=r[d],m=L(p,0,1),f=L(p,-1);if(('"'===m||"'"===m||"`"===m||'"'===f||"'"===f||"`"===f)&&m!==f)throw new c("property names with quotes must have matching quotes");if("constructor"!==p&&h||(a=!0),i+="."+p,q(j,n="%"+i+"%"))o=j[n];else if(null!=o){if(!(p in o)){if(!t)throw new u("base intrinsic for "+e+" exists, but the property is not available.");return}if(b&&d+1>=r.length){var y=b(o,p);o=(h=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:o[p]}else h=q(o,p),o=o[p];h&&!a&&(j[n]=o)}}return o}},67209:(e,t,r)=>{"use strict";var i=r(15678);e.exports=i.getPrototypeOf||null},32395:e=>{"use strict";e.exports="undefined"!=typeof Reflect&&Reflect.getPrototypeOf||null},93941:(e,t,r)=>{"use strict";var i=r(32395),s=r(67209),n=r(62344);e.exports=i?function(e){return i(e)}:s?function(e){if(!e||"object"!=typeof e&&"function"!=typeof e)throw TypeError("getProto: not an object");return s(e)}:n?function(e){return n(e)}:null},62980:e=>{"use strict";e.exports=Object.getOwnPropertyDescriptor},86737:(e,t,r)=>{"use strict";var i=r(62980);if(i)try{i([],"length")}catch(e){i=null}e.exports=i},91976:(e,t,r)=>{"use strict";var i="undefined"!=typeof Symbol&&Symbol,s=r(12522);e.exports=function(){return"function"==typeof i&&"function"==typeof Symbol&&"symbol"==typeof i("foo")&&"symbol"==typeof Symbol("bar")&&s()}},12522:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),r=Object(t);if("string"==typeof t||"[object Symbol]"!==Object.prototype.toString.call(t)||"[object Symbol]"!==Object.prototype.toString.call(r))return!1;for(var i in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var s=Object.getOwnPropertySymbols(e);if(1!==s.length||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var n=Object.getOwnPropertyDescriptor(e,t);if(42!==n.value||!0!==n.enumerable)return!1}return!0}},64995:(e,t,r)=>{"use strict";var i=Function.prototype.call,s=Object.prototype.hasOwnProperty,n=r(31660);e.exports=n.call(i,s)},95175:e=>{"use strict";e.exports=Math.abs},22334:e=>{"use strict";e.exports=Math.floor},61781:e=>{"use strict";e.exports=Number.isNaN||function(e){return e!=e}},46082:e=>{"use strict";e.exports=Math.max},40430:e=>{"use strict";e.exports=Math.min},24210:e=>{"use strict";e.exports=Math.pow},70792:e=>{"use strict";e.exports=Math.round},92615:(e,t,r)=>{"use strict";var i=r(61781);e.exports=function(e){return i(e)||0===e?e:e<0?-1:1}},19966:(e,t,r)=>{var i="function"==typeof Map&&Map.prototype,s=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,n=i&&s&&"function"==typeof s.get?s.get:null,o=i&&Map.prototype.forEach,a="function"==typeof Set&&Set.prototype,l=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,c=a&&l&&"function"==typeof l.get?l.get:null,u=a&&Set.prototype.forEach,d="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,h="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,p="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,m=Boolean.prototype.valueOf,f=Object.prototype.toString,y=Function.prototype.toString,g=String.prototype.match,v=String.prototype.slice,_=String.prototype.replace,P=String.prototype.toUpperCase,b=String.prototype.toLowerCase,T=RegExp.prototype.test,E=Array.prototype.concat,S=Array.prototype.join,w=Array.prototype.slice,x=Math.floor,O="function"==typeof BigInt?BigInt.prototype.valueOf:null,A=Object.getOwnPropertySymbols,k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,C="function"==typeof Symbol&&"object"==typeof Symbol.iterator,R="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===C?"object":"symbol")?Symbol.toStringTag:null,I=Object.prototype.propertyIsEnumerable,j=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function G(e,t){if(e===1/0||e===-1/0||e!=e||e&&e>-1e3&&e<1e3||T.call(/e/,t))return t;var r=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof e){var i=e<0?-x(-e):x(e);if(i!==e){var s=String(i),n=v.call(t,s.length+1);return _.call(s,r,"$&_")+"."+_.call(_.call(n,/([0-9]{3})/g,"$&_"),/_$/,"")}}return _.call(t,r,"$&_")}var M=r(71660),D=M.custom,N=W(D)?D:null,q={__proto__:null,double:'"',single:"'"},$={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};function U(e,t,r){var i=q[r.quoteStyle||t];return i+e+i}function F(e){return!R||!("object"==typeof e&&(R in e||void 0!==e[R]))}function L(e){return"[object Array]"===K(e)&&F(e)}function H(e){return"[object RegExp]"===K(e)&&F(e)}function W(e){if(C)return e&&"object"==typeof e&&e instanceof Symbol;if("symbol"==typeof e)return!0;if(!e||"object"!=typeof e||!k)return!1;try{return k.call(e),!0}catch(e){}return!1}e.exports=function e(t,r,i,s){var a=r||{};if(B(a,"quoteStyle")&&!B(q,a.quoteStyle))throw TypeError('option "quoteStyle" must be "single" or "double"');if(B(a,"maxStringLength")&&("number"==typeof a.maxStringLength?a.maxStringLength<0&&a.maxStringLength!==1/0:null!==a.maxStringLength))throw TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var l=!B(a,"customInspect")||a.customInspect;if("boolean"!=typeof l&&"symbol"!==l)throw TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(B(a,"indent")&&null!==a.indent&&"	"!==a.indent&&!(parseInt(a.indent,10)===a.indent&&a.indent>0))throw TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(B(a,"numericSeparator")&&"boolean"!=typeof a.numericSeparator)throw TypeError('option "numericSeparator", if provided, must be `true` or `false`');var f=a.numericSeparator;if(void 0===t)return"undefined";if(null===t)return"null";if("boolean"==typeof t)return t?"true":"false";if("string"==typeof t)return function e(t,r){if(t.length>r.maxStringLength){var i=t.length-r.maxStringLength;return e(v.call(t,0,r.maxStringLength),r)+"... "+i+" more character"+(i>1?"s":"")}var s=$[r.quoteStyle||"single"];return s.lastIndex=0,U(_.call(_.call(t,s,"\\$1"),/[\x00-\x1f]/g,J),"single",r)}(t,a);if("number"==typeof t){if(0===t)return 1/0/t>0?"0":"-0";var P=String(t);return f?G(t,P):P}if("bigint"==typeof t){var T=String(t)+"n";return f?G(t,T):T}var x=void 0===a.depth?5:a.depth;if(void 0===i&&(i=0),i>=x&&x>0&&"object"==typeof t)return L(t)?"[Array]":"[Object]";var A=function(e,t){var r;if("	"===e.indent)r="	";else{if("number"!=typeof e.indent||!(e.indent>0))return null;r=S.call(Array(e.indent+1)," ")}return{base:r,prev:S.call(Array(t+1),r)}}(a,i);if(void 0===s)s=[];else if(V(s,t)>=0)return"[Circular]";function D(t,r,n){if(r&&(s=w.call(s)).push(r),n){var o={depth:a.depth};return B(a,"quoteStyle")&&(o.quoteStyle=a.quoteStyle),e(t,o,i+1,s)}return e(t,a,i+1,s)}if("function"==typeof t&&!H(t)){var z=function(e){if(e.name)return e.name;var t=g.call(y.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}(t),et=ee(t,D);return"[Function"+(z?": "+z:" (anonymous)")+"]"+(et.length>0?" { "+S.call(et,", ")+" }":"")}if(W(t)){var er=C?_.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):k.call(t);return"object"!=typeof t||C?er:Q(er)}if(t&&"object"==typeof t&&("undefined"!=typeof HTMLElement&&t instanceof HTMLElement||"string"==typeof t.nodeName&&"function"==typeof t.getAttribute)){for(var ei,es="<"+b.call(String(t.nodeName)),en=t.attributes||[],eo=0;eo<en.length;eo++)es+=" "+en[eo].name+"="+U((ei=en[eo].value,_.call(String(ei),/"/g,"&quot;")),"double",a);return es+=">",t.childNodes&&t.childNodes.length&&(es+="..."),es+="</"+b.call(String(t.nodeName))+">"}if(L(t)){if(0===t.length)return"[]";var ea=ee(t,D);return A&&!function(e){for(var t=0;t<e.length;t++)if(V(e[t],"\n")>=0)return!1;return!0}(ea)?"["+Z(ea,A)+"]":"[ "+S.call(ea,", ")+" ]"}if("[object Error]"===K(t)&&F(t)){var el=ee(t,D);return"cause"in Error.prototype||!("cause"in t)||I.call(t,"cause")?0===el.length?"["+String(t)+"]":"{ ["+String(t)+"] "+S.call(el,", ")+" }":"{ ["+String(t)+"] "+S.call(E.call("[cause]: "+D(t.cause),el),", ")+" }"}if("object"==typeof t&&l){if(N&&"function"==typeof t[N]&&M)return M(t,{depth:x-i});if("symbol"!==l&&"function"==typeof t.inspect)return t.inspect()}if(function(e){if(!n||!e||"object"!=typeof e)return!1;try{n.call(e);try{c.call(e)}catch(e){return!0}return e instanceof Map}catch(e){}return!1}(t)){var ec=[];return o&&o.call(t,function(e,r){ec.push(D(r,t,!0)+" => "+D(e,t))}),Y("Map",n.call(t),ec,A)}if(function(e){if(!c||!e||"object"!=typeof e)return!1;try{c.call(e);try{n.call(e)}catch(e){return!0}return e instanceof Set}catch(e){}return!1}(t)){var eu=[];return u&&u.call(t,function(e){eu.push(D(e,t))}),Y("Set",c.call(t),eu,A)}if(function(e){if(!d||!e||"object"!=typeof e)return!1;try{d.call(e,d);try{h.call(e,h)}catch(e){return!0}return e instanceof WeakMap}catch(e){}return!1}(t))return X("WeakMap");if(function(e){if(!h||!e||"object"!=typeof e)return!1;try{h.call(e,h);try{d.call(e,d)}catch(e){return!0}return e instanceof WeakSet}catch(e){}return!1}(t))return X("WeakSet");if(function(e){if(!p||!e||"object"!=typeof e)return!1;try{return p.call(e),!0}catch(e){}return!1}(t))return X("WeakRef");if("[object Number]"===K(t)&&F(t))return Q(D(Number(t)));if(function(e){if(!e||"object"!=typeof e||!O)return!1;try{return O.call(e),!0}catch(e){}return!1}(t))return Q(D(O.call(t)));if("[object Boolean]"===K(t)&&F(t))return Q(m.call(t));if("[object String]"===K(t)&&F(t))return Q(D(String(t)));if("undefined"!=typeof window&&t===window)return"{ [object Window] }";if("undefined"!=typeof globalThis&&t===globalThis||"undefined"!=typeof global&&t===global)return"{ [object globalThis] }";if(!("[object Date]"===K(t)&&F(t))&&!H(t)){var ed=ee(t,D),eh=j?j(t)===Object.prototype:t instanceof Object||t.constructor===Object,ep=t instanceof Object?"":"null prototype",em=!eh&&R&&Object(t)===t&&R in t?v.call(K(t),8,-1):ep?"Object":"",ef=(eh||"function"!=typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"")+(em||ep?"["+S.call(E.call([],em||[],ep||[]),": ")+"] ":"");return 0===ed.length?ef+"{}":A?ef+"{"+Z(ed,A)+"}":ef+"{ "+S.call(ed,", ")+" }"}return String(t)};var z=Object.prototype.hasOwnProperty||function(e){return e in this};function B(e,t){return z.call(e,t)}function K(e){return f.call(e)}function V(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return -1}function J(e){var t=e.charCodeAt(0),r={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return r?"\\"+r:"\\x"+(t<16?"0":"")+P.call(t.toString(16))}function Q(e){return"Object("+e+")"}function X(e){return e+" { ? }"}function Y(e,t,r,i){return e+" ("+t+") {"+(i?Z(r,i):S.call(r,", "))+"}"}function Z(e,t){if(0===e.length)return"";var r="\n"+t.prev+t.base;return r+S.call(e,","+r)+"\n"+t.prev}function ee(e,t){var r,i=L(e),s=[];if(i){s.length=e.length;for(var n=0;n<e.length;n++)s[n]=B(e,n)?t(e[n],e):""}var o="function"==typeof A?A(e):[];if(C){r={};for(var a=0;a<o.length;a++)r["$"+o[a]]=o[a]}for(var l in e)B(e,l)&&(!i||String(Number(l))!==l||!(l<e.length))&&(C&&r["$"+l]instanceof Symbol||(T.call(/[^\w$]/,l)?s.push(t(l,e)+": "+t(e[l],e)):s.push(l+": "+t(e[l],e))));if("function"==typeof A)for(var c=0;c<o.length;c++)I.call(e,o[c])&&s.push("["+t(o[c])+"]: "+t(e[o[c]],e));return s}},71660:(e,t,r)=>{e.exports=r(21764).inspect},92565:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runSchemaQuery=t.runCreateQuery=t.createDb=void 0;let i=r(35900),s=r(10305);async function n(e,t,r={}){if("string"!=typeof e)throw Error("Must pass database name as a string");let n=null!=r.logger?r.logger:()=>{};if(null==t)throw Error("No config object");if("client"in t)return o(e,n)(t.client);if("string"!=typeof t.user||"string"!=typeof t.password||"string"!=typeof t.host||"number"!=typeof t.port)throw Error("Database config problem");let{user:a,password:l,host:c,port:u}=t,d=new i.Client({database:null!=t.defaultDatabase?t.defaultDatabase:"postgres",user:a,password:l,host:c,port:u});return d.on("error",e=>{n(`pg client emitted an error: ${e.message}`)}),s.withConnection(n,o(e,n))(d)}function o(e,t){return async r=>{await r.query(`CREATE DATABASE "${e.replace(/\"/g,'""')}"`).catch(r=>{if("42P04"===r.code){t(`'${e}' database already exists`);return}throw t(r),Error(`Error creating database. Caused by: '${r.name}: ${r.message}'`)})}}t.createDb=n,t.runCreateQuery=o,t.runSchemaQuery=function(e,t){return async r=>{await r.query(`CREATE SCHEMA IF NOT EXISTS ${e}`).catch(r=>{t(`'${e}' scheme already exists`)})}}},90386:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseFileName=void 0;let r=e=>{let t=parseInt(e,10);if(isNaN(t))throw Error("Migration file name should begin with an integer ID.'");return t};t.parseFileName=e=>{let t=/^(-?\d+)[-_]?(.*).(sql|js)$/gi.exec(e);if(!t)throw Error(`Invalid file name: '${e}'.`);let[,i,s,n]=t,o=n.toLowerCase();if("js"!==o&&"sql"!==o)throw Error("Not a JS or SQL file");return{id:r(i),name:null==s||""===s?e:s,type:o}}},4082:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadMigrationFiles=void 0;let i=r(92048),s=r(55315),n=r(21764),o=r(80413),a=r(30711),l=n.promisify(i.readdir),c=e=>/\.(sql|js)$/gi.test(e),u=async(e,t=()=>{})=>{t(`Loading migrations from: ${e}`);let r=await l(e);if(t(`Found migration files: ${r}`),null==r)return[];let i=[...r.map(t=>s.resolve(e,t))].filter(c),n=(await Promise.all(i.map(o.loadMigrationFile))).sort((e,t)=>e.id-t.id);return a.validateMigrationOrdering(n),n};t.loadMigrationFiles=u},78052:(e,t,r)=>{"use strict";r(92565),r(36933),r(4082),r(16880)},55058:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadSqlFromJs=void 0;let i=r(55315);t.loadSqlFromJs=e=>{let t=r(41919)(e);if(!t.generateSql)throw Error(`Invalid javascript migration file: '${i.basename(e)}'.
It must to export a 'generateSql' function.`);let s=t.generateSql();if("string"!=typeof s)throw Error(`Invalid javascript migration file: '${i.basename(e)}'.
'generateSql' function must return a string literal.`);return s}},36933:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.migrate=void 0;let i=r(35900),s=r(89490),n=r(92565),o=r(4082),a=r(20566),l=r(30711),c=r(10305),u=r(99427);async function d(e,t,r={}){let s=null!=r.logger?r.logger:()=>{},a={tableName:"tableName"in r&&void 0!==r.tableName?r.tableName:"migrations",schemaName:"schemaName"in r&&void 0!==r.schemaName?r.schemaName:"public"};if(null==e)throw Error("No config object");if("string"!=typeof t)throw Error("Must pass migrations directory as a string");let l=await o.loadMigrationFiles(t,s);if("client"in e)return u.withAdvisoryLock(s,h(l,s,a))(e.client);if("string"!=typeof e.database||"string"!=typeof e.user||"string"!=typeof e.password||"string"!=typeof e.host||"number"!=typeof e.port)throw Error("Database config problem");if(!0===e.ensureDatabaseExists){let{user:t,password:r,host:o,port:l}=e,u=new i.Client({database:null!=e.defaultDatabase?e.defaultDatabase:"postgres",user:t,password:r,host:o,port:l}),d=c.withConnection(s,async t=>{1!==(await t.query({text:"SELECT 1 FROM pg_database WHERE datname=$1",values:[e.database]})).rowCount&&await n.runCreateQuery(e.database,s)(t)});await d(u);let h=c.withConnection(s,async e=>{await n.runSchemaQuery(a.schemaName,s)(e)});await h(u)}{let t=new i.Client(e);return t.on("error",e=>{s(`pg client emitted an error: ${e.message}`)}),c.withConnection(s,u.withAdvisoryLock(s,h(l,s,a)))(t)}}function h(e,t,r){return async i=>{try{t(`Starting migrations against schema ${r.schemaName}`);let s=await p(r.tableName,r.schemaName,i,t);l.validateMigrationHashes(e,s);let n=e.filter(e=>!s[e.id]),o=[];for(let e of n){t(`Starting migration: ${e.id} ${e.name}`);let s=await a.runMigration(r.tableName,r.schemaName,i,t)(e);t(`Finished migration: ${e.id} ${e.name}`),o.push(s)}return t(0===o.length?"No migrations applied":`Successfully applied migrations: ${o.map(({name:e})=>e)}`),t("Finished migrations"),o}catch(t){let e=Error(`Migration failed. Reason: ${t.message}`);throw e.cause=t.message,e}}}async function p(e,t,r,i){let s=[];if(await m(r,e,t)){i(`Migrations table with name '${t}.${e}' exists, filtering not applied migrations.`);let{rows:n}=await r.query(`SELECT * FROM ${t}.${e} ORDER BY id`);s=n}else await r.query(`
        CREATE TABLE IF NOT EXISTS ${t}.${e} (
          id integer PRIMARY KEY,
          name varchar(100) UNIQUE NOT NULL,
          hash varchar(40) NOT NULL, -- sha1 hex encoded hash of the file name and contents, to ensure it hasn't been altered since applying the migration
          executed_at timestamp DEFAULT current_timestamp
        );
    `),i(`Migrations table with name '${t}.${e}' has been created!`);return s}async function m(e,t,r){let i=await e.query(s.default`SELECT EXISTS (
    SELECT 1
    FROM information_schema.tables
    WHERE table_schema = ${r}
    AND table_name = ${t}
  );`);return i.rows.length>0&&i.rows[0].exists}t.migrate=d},80413:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadMigrationFile=void 0;let i=r(21764),s=r(92048),n=r(55315),o=r(84770),a=r(55058),l=r(90386),c=i.promisify(s.readFile),u=e=>n.basename(e),d=async e=>c(e,"utf8"),h=e=>o.createHash("sha1").update(e,"utf8").digest("hex"),p=(e,t,r)=>{switch(r){case"sql":return t;case"js":return a.loadSqlFromJs(e);default:return r}},m=async e=>{let t=u(e);try{let{id:r,name:i,type:s}=l.parseFileName(t),n=await d(e),o=p(e,n,s),a=h(t+o);return{id:r,name:i,contents:n,fileName:t,hash:a,sql:o}}catch(e){throw Error(`${e.message} - Offending file: '${t}'.`)}};t.loadMigrationFile=m},20566:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.runMigration=void 0;let i=r(89490),s=()=>{},n=async(e="migrations",t="public",r,s,n)=>{n(`Saving migration to '${t}.${e}': ${s.id} | ${s.name} | ${s.hash}`);let o=i.default`INSERT INTO `.append(`${t}.${e}`).append(i.default` ("id", "name", "hash") VALUES (${s.id},${s.name},${s.hash})`);return r.query(o)};t.runMigration=(e="migrations",t="public",r,i=s)=>async o=>{let a=!1===o.sql.includes("-- postgres-migrations disable-transaction");i(`Running migration in transaction: ${a}`);let l=a?()=>r.query("START TRANSACTION"):s,c=a?()=>r.query("COMMIT"):s,u=a?()=>r.query("ROLLBACK"):s;try{return await l(),await r.query(o.sql),await n(e,t,r,o,i),await c(),o}catch(e){try{await u()}catch(e){}throw Error(`An error occurred running '${o.name}'. Rolled back this migration. No further migrations were run. Reason: ${e.message}`)}}},16880:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MigrationError=void 0;class r extends Error{}t.MigrationError=r},30711:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.validateMigrationHashes=t.validateMigrationOrdering=void 0;let r=(e,t)=>e.id!==t;t.validateMigrationOrdering=function(e){let t=e.find(r);if(t)throw Error(`Found a non-consecutive migration ID on file: '${t.fileName}'`)},t.validateMigrationHashes=function(e,t){let r=e.filter(e=>{let r=t[e.id];return null!=r&&r.hash!==e.hash});if(r.length>0){let e=r.map(({fileName:e})=>e);throw Error(`Hashes don't match for migrations '${e}'.
This means that the scripts have changed since it was applied.`)}}},10305:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withConnection=void 0,t.withConnection=function(e,t){return async r=>{try{try{e("Connecting to database..."),await r.connect(),e("... connected to database")}catch(t){throw e(`Error connecting to database: ${t.message}`),t}return await t(r)}catch(t){throw e(`Error using connection: ${t.message}`),t}finally{try{e("Closing connection..."),await r.end(),e("... connection closed")}catch(t){e(`Error closing the connection: ${t.message}`)}}}}},99427:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withAdvisoryLock=void 0,t.withAdvisoryLock=function(e,t){return async r=>{try{try{e("Acquiring advisory lock...");let t=!1;for(;!t;){let e=await r.query("SELECT pg_try_advisory_lock(-8525285245963000605);");!0===e.rows[0].pg_try_advisory_lock?t=!0:await new Promise(e=>setTimeout(e,1e3))}e("... acquired advisory lock")}catch(t){throw e(`Error acquiring advisory lock: ${t.message}`),t}return await t(r)}catch(t){throw e(`Error while using lock: ${t.message}`),t}finally{try{e("Releasing advisory lock..."),await r.query("SELECT pg_advisory_unlock(-8525285245963000605);"),e("... released advisory lock")}catch(t){e(`Error releasing advisory lock: ${t.message}`)}}}}},26815:e=>{"use strict";var t=String.prototype.replace,r=/%20/g,i={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports={default:i.RFC3986,formatters:{RFC1738:function(e){return t.call(e,r,"+")},RFC3986:function(e){return String(e)}},RFC1738:i.RFC1738,RFC3986:i.RFC3986}},6684:(e,t,r)=>{"use strict";var i=r(52503),s=r(23273),n=r(26815);e.exports={formats:n,parse:s,stringify:i}},23273:(e,t,r)=>{"use strict";var i=r(31847),s=Object.prototype.hasOwnProperty,n=Array.isArray,o={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},a=function(e,t,r){if(e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1)return e.split(",");if(t.throwOnLimitExceeded&&r>=t.arrayLimit)throw RangeError("Array limit exceeded. Only "+t.arrayLimit+" element"+(1===t.arrayLimit?"":"s")+" allowed in an array.");return e},l=function(e,t){var r={__proto__:null},l=t.ignoreQueryPrefix?e.replace(/^\?/,""):e;l=l.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var c=t.parameterLimit===1/0?void 0:t.parameterLimit,u=l.split(t.delimiter,t.throwOnLimitExceeded?c+1:c);if(t.throwOnLimitExceeded&&u.length>c)throw RangeError("Parameter limit exceeded. Only "+c+" parameter"+(1===c?"":"s")+" allowed.");var d=-1,h=t.charset;if(t.charsetSentinel)for(p=0;p<u.length;++p)0===u[p].indexOf("utf8=")&&("utf8=%E2%9C%93"===u[p]?h="utf-8":"utf8=%26%2310003%3B"===u[p]&&(h="iso-8859-1"),d=p,p=u.length);for(p=0;p<u.length;++p)if(p!==d){var p,m,f,y=u[p],g=y.indexOf("]="),v=-1===g?y.indexOf("="):g+1;-1===v?(m=t.decoder(y,o.decoder,h,"key"),f=t.strictNullHandling?null:""):(m=t.decoder(y.slice(0,v),o.decoder,h,"key"),f=i.maybeMap(a(y.slice(v+1),t,n(r[m])?r[m].length:0),function(e){return t.decoder(e,o.decoder,h,"value")})),f&&t.interpretNumericEntities&&"iso-8859-1"===h&&(f=String(f).replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(parseInt(t,10))})),y.indexOf("[]=")>-1&&(f=n(f)?[f]:f);var _=s.call(r,m);_&&"combine"===t.duplicates?r[m]=i.combine(r[m],f):_&&"last"!==t.duplicates||(r[m]=f)}return r},c=function(e,t,r,s){var n=0;if(e.length>0&&"[]"===e[e.length-1]){var o=e.slice(0,-1).join("");n=Array.isArray(t)&&t[o]?t[o].length:0}for(var l=s?t:a(t,r,n),c=e.length-1;c>=0;--c){var u,d=e[c];if("[]"===d&&r.parseArrays)u=r.allowEmptyArrays&&(""===l||r.strictNullHandling&&null===l)?[]:i.combine([],l);else{u=r.plainObjects?{__proto__:null}:{};var h="["===d.charAt(0)&&"]"===d.charAt(d.length-1)?d.slice(1,-1):d,p=r.decodeDotInKeys?h.replace(/%2E/g,"."):h,m=parseInt(p,10);r.parseArrays||""!==p?!isNaN(m)&&d!==p&&String(m)===p&&m>=0&&r.parseArrays&&m<=r.arrayLimit?(u=[])[m]=l:"__proto__"!==p&&(u[p]=l):u={0:l}}l=u}return l},u=function(e,t,r,i){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/g,a=r.depth>0&&/(\[[^[\]]*])/.exec(n),l=a?n.slice(0,a.index):n,u=[];if(l){if(!r.plainObjects&&s.call(Object.prototype,l)&&!r.allowPrototypes)return;u.push(l)}for(var d=0;r.depth>0&&null!==(a=o.exec(n))&&d<r.depth;){if(d+=1,!r.plainObjects&&s.call(Object.prototype,a[1].slice(1,-1))&&!r.allowPrototypes)return;u.push(a[1])}if(a){if(!0===r.strictDepth)throw RangeError("Input depth exceeded depth option of "+r.depth+" and strictDepth is true");u.push("["+n.slice(a.index)+"]")}return c(u,t,r,i)}},d=function(e){if(!e)return o;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.decodeDotInKeys&&"boolean"!=typeof e.decodeDotInKeys)throw TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(void 0!==e.throwOnLimitExceeded&&"boolean"!=typeof e.throwOnLimitExceeded)throw TypeError("`throwOnLimitExceeded` option must be a boolean");var t=void 0===e.charset?o.charset:e.charset,r=void 0===e.duplicates?o.duplicates:e.duplicates;if("combine"!==r&&"first"!==r&&"last"!==r)throw TypeError("The duplicates option must be either combine, first, or last");return{allowDots:void 0===e.allowDots?!0===e.decodeDotInKeys||o.allowDots:!!e.allowDots,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:o.allowEmptyArrays,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"==typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:o.comma,decodeDotInKeys:"boolean"==typeof e.decodeDotInKeys?e.decodeDotInKeys:o.decodeDotInKeys,decoder:"function"==typeof e.decoder?e.decoder:o.decoder,delimiter:"string"==typeof e.delimiter||i.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:o.depth,duplicates:r,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:o.plainObjects,strictDepth:"boolean"==typeof e.strictDepth?!!e.strictDepth:o.strictDepth,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling,throwOnLimitExceeded:"boolean"==typeof e.throwOnLimitExceeded&&e.throwOnLimitExceeded}};e.exports=function(e,t){var r=d(t);if(""===e||null==e)return r.plainObjects?{__proto__:null}:{};for(var s="string"==typeof e?l(e,r):e,n=r.plainObjects?{__proto__:null}:{},o=Object.keys(s),a=0;a<o.length;++a){var c=o[a],h=u(c,s[c],r,"string"==typeof e);n=i.merge(n,h,r)}return!0===r.allowSparse?n:i.compact(n)}},52503:(e,t,r)=>{"use strict";var i=r(49211),s=r(31847),n=r(26815),o=Object.prototype.hasOwnProperty,a={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},l=Array.isArray,c=Array.prototype.push,u=function(e,t){c.apply(e,l(t)?t:[t])},d=Date.prototype.toISOString,h=n.default,p={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:s.encode,encodeValuesOnly:!1,filter:void 0,format:h,formatter:n.formatters[h],indices:!1,serializeDate:function(e){return d.call(e)},skipNulls:!1,strictNullHandling:!1},m={},f=function e(t,r,n,o,a,c,d,h,f,y,g,v,_,P,b,T,E,S){for(var w,x,O=t,A=S,k=0,C=!1;void 0!==(A=A.get(m))&&!C;){var R=A.get(t);if(k+=1,void 0!==R){if(R===k)throw RangeError("Cyclic object value");C=!0}void 0===A.get(m)&&(k=0)}if("function"==typeof y?O=y(r,O):O instanceof Date?O=_(O):"comma"===n&&l(O)&&(O=s.maybeMap(O,function(e){return e instanceof Date?_(e):e})),null===O){if(c)return f&&!T?f(r,p.encoder,E,"key",P):r;O=""}if("string"==typeof(w=O)||"number"==typeof w||"boolean"==typeof w||"symbol"==typeof w||"bigint"==typeof w||s.isBuffer(O))return f?[b(T?r:f(r,p.encoder,E,"key",P))+"="+b(f(O,p.encoder,E,"value",P))]:[b(r)+"="+b(String(O))];var I=[];if(void 0===O)return I;if("comma"===n&&l(O))T&&f&&(O=s.maybeMap(O,f)),x=[{value:O.length>0?O.join(",")||null:void 0}];else if(l(y))x=y;else{var j=Object.keys(O);x=g?j.sort(g):j}var G=h?String(r).replace(/\./g,"%2E"):String(r),M=o&&l(O)&&1===O.length?G+"[]":G;if(a&&l(O)&&0===O.length)return M+"[]";for(var D=0;D<x.length;++D){var N=x[D],q="object"==typeof N&&N&&void 0!==N.value?N.value:O[N];if(!d||null!==q){var $=v&&h?String(N).replace(/\./g,"%2E"):String(N),U=l(O)?"function"==typeof n?n(M,$):M:M+(v?"."+$:"["+$+"]");S.set(t,k);var F=i();F.set(m,S),u(I,e(q,U,n,o,a,c,d,h,"comma"===n&&T&&l(O)?null:f,y,g,v,_,P,b,T,E,F))}}return I},y=function(e){if(!e)return p;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");var t,r=e.charset||p.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var i=n.default;if(void 0!==e.format){if(!o.call(n.formatters,e.format))throw TypeError("Unknown format option provided.");i=e.format}var s=n.formatters[i],c=p.filter;if(("function"==typeof e.filter||l(e.filter))&&(c=e.filter),t=e.arrayFormat in a?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":p.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");var u=void 0===e.allowDots?!0===e.encodeDotInKeys||p.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:u,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:p.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?p.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:p.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:p.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:c,format:i,formatter:s,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}};e.exports=function(e,t){var r,s=e,n=y(t);"function"==typeof n.filter?s=(0,n.filter)("",s):l(n.filter)&&(r=n.filter);var o=[];if("object"!=typeof s||null===s)return"";var c=a[n.arrayFormat],d="comma"===c&&n.commaRoundTrip;r||(r=Object.keys(s)),n.sort&&r.sort(n.sort);for(var h=i(),p=0;p<r.length;++p){var m=r[p],g=s[m];n.skipNulls&&null===g||u(o,f(g,m,c,d,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,h))}var v=o.join(n.delimiter),_=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?_+="utf8=%26%2310003%3B&":_+="utf8=%E2%9C%93&"),v.length>0?_+v:""}},31847:(e,t,r)=>{"use strict";var i=r(26815),s=Object.prototype.hasOwnProperty,n=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),a=function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(n(r)){for(var i=[],s=0;s<r.length;++s)void 0!==r[s]&&i.push(r[s]);t.obj[t.prop]=i}}},l=function(e,t){for(var r=t&&t.plainObjects?{__proto__:null}:{},i=0;i<e.length;++i)void 0!==e[i]&&(r[i]=e[i]);return r};e.exports={arrayToObject:l,assign:function(e,t){return Object.keys(t).reduce(function(e,r){return e[r]=t[r],e},e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var s=t[i],n=s.obj[s.prop],o=Object.keys(n),l=0;l<o.length;++l){var c=o[l],u=n[c];"object"==typeof u&&null!==u&&-1===r.indexOf(u)&&(t.push({obj:n,prop:c}),r.push(u))}return a(t),e},decode:function(e,t,r){var i=e.replace(/\+/g," ");if("iso-8859-1"===r)return i.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(i)}catch(e){return i}},encode:function(e,t,r,s,n){if(0===e.length)return e;var a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===r)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});for(var l="",c=0;c<a.length;c+=1024){for(var u=a.length>=1024?a.slice(c,c+1024):a,d=[],h=0;h<u.length;++h){var p=u.charCodeAt(h);if(45===p||46===p||95===p||126===p||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||n===i.RFC1738&&(40===p||41===p)){d[d.length]=u.charAt(h);continue}if(p<128){d[d.length]=o[p];continue}if(p<2048){d[d.length]=o[192|p>>6]+o[128|63&p];continue}if(p<55296||p>=57344){d[d.length]=o[224|p>>12]+o[128|p>>6&63]+o[128|63&p];continue}h+=1,p=65536+((1023&p)<<10|1023&u.charCodeAt(h)),d[d.length]=o[240|p>>18]+o[128|p>>12&63]+o[128|p>>6&63]+o[128|63&p]}l+=d.join("")}return l},isBuffer:function(e){return!!e&&"object"==typeof e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},maybeMap:function(e,t){if(n(e)){for(var r=[],i=0;i<e.length;i+=1)r.push(t(e[i]));return r}return t(e)},merge:function e(t,r,i){if(!r)return t;if("object"!=typeof r&&"function"!=typeof r){if(n(t))t.push(r);else{if(!t||"object"!=typeof t)return[t,r];(i&&(i.plainObjects||i.allowPrototypes)||!s.call(Object.prototype,r))&&(t[r]=!0)}return t}if(!t||"object"!=typeof t)return[t].concat(r);var o=t;return(n(t)&&!n(r)&&(o=l(t,i)),n(t)&&n(r))?(r.forEach(function(r,n){if(s.call(t,n)){var o=t[n];o&&"object"==typeof o&&r&&"object"==typeof r?t[n]=e(o,r,i):t.push(r)}else t[n]=r}),t):Object.keys(r).reduce(function(t,n){var o=r[n];return s.call(t,n)?t[n]=e(t[n],o,i):t[n]=o,t},o)}}},52185:(e,t,r)=>{"use strict";var i=r(19966),s=r(17445),n=function(e,t,r){for(var i,s=e;null!=(i=s.next);s=i)if(i.key===t)return s.next=i.next,r||(i.next=e.next,e.next=i),i},o=function(e,t){if(e){var r=n(e,t);return r&&r.value}},a=function(e,t,r){var i=n(e,t);i?i.value=r:e.next={key:t,next:e.next,value:r}},l=function(e,t){if(e)return n(e,t,!0)};e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new s("Side channel does not contain "+i(e))},delete:function(t){var r=e&&e.next,i=l(e,t);return i&&r&&r===i&&(e=void 0),!!i},get:function(t){return o(e,t)},has:function(t){var r;return!!(r=e)&&!!n(r,t)},set:function(t,r){e||(e={next:void 0}),a(e,t,r)}};return t}},10417:(e,t,r)=>{"use strict";var i=r(2749),s=r(98363),n=r(19966),o=r(17445),a=i("%Map%",!0),l=s("Map.prototype.get",!0),c=s("Map.prototype.set",!0),u=s("Map.prototype.has",!0),d=s("Map.prototype.delete",!0),h=s("Map.prototype.size",!0);e.exports=!!a&&function(){var e,t={assert:function(e){if(!t.has(e))throw new o("Side channel does not contain "+n(e))},delete:function(t){if(e){var r=d(e,t);return 0===h(e)&&(e=void 0),r}return!1},get:function(t){if(e)return l(e,t)},has:function(t){return!!e&&u(e,t)},set:function(t,r){e||(e=new a),c(e,t,r)}};return t}},33457:(e,t,r)=>{"use strict";var i=r(2749),s=r(98363),n=r(19966),o=r(10417),a=r(17445),l=i("%WeakMap%",!0),c=s("WeakMap.prototype.get",!0),u=s("WeakMap.prototype.set",!0),d=s("WeakMap.prototype.has",!0),h=s("WeakMap.prototype.delete",!0);e.exports=l?function(){var e,t,r={assert:function(e){if(!r.has(e))throw new a("Side channel does not contain "+n(e))},delete:function(r){if(l&&r&&("object"==typeof r||"function"==typeof r)){if(e)return h(e,r)}else if(o&&t)return t.delete(r);return!1},get:function(r){return l&&r&&("object"==typeof r||"function"==typeof r)&&e?c(e,r):t&&t.get(r)},has:function(r){return l&&r&&("object"==typeof r||"function"==typeof r)&&e?d(e,r):!!t&&t.has(r)},set:function(r,i){l&&r&&("object"==typeof r||"function"==typeof r)?(e||(e=new l),u(e,r,i)):o&&(t||(t=o()),t.set(r,i))}};return r}:o},49211:(e,t,r)=>{"use strict";var i=r(17445),s=r(19966),n=r(52185),o=r(10417),a=r(33457)||o||n;e.exports=function(){var e,t={assert:function(e){if(!t.has(e))throw new i("Side channel does not contain "+s(e))},delete:function(t){return!!e&&e.delete(t)},get:function(t){return e&&e.get(t)},has:function(t){return!!e&&e.has(t)},set:function(t,r){e||(e=a()),e.set(t,r)}};return t}},89490:e=>{"use strict";class t{constructor(e,t){this.strings=e,this.values=t}get query(){return this.bind?this.text:this.sql}get text(){return this.strings.reduce((e,t,r)=>e+"$"+r+t)}append(e){return e instanceof t?(this.strings[this.strings.length-1]+=e.strings[0],this.strings.push.apply(this.strings,e.strings.slice(1)),(this.values||this.bind).push.apply(this.values,e.values)):this.strings[this.strings.length-1]+=e,this}useBind(e){return void 0===e&&(e=!0),e&&!this.bind?(this.bind=this.values,delete this.values):!e&&this.bind&&(this.values=this.bind,delete this.bind),this}setName(e){return this.name=e,this}}function r(e){return new t(e.slice(0),Array.from(arguments).slice(1))}Object.defineProperty(t.prototype,"sql",{enumerable:!0,get(){return this.strings.join("?")}}),e.exports=r,e.exports.SQL=r,e.exports.default=r,e.exports.SQLStatement=t},4820:(e,t,r)=>{let i=r(92048),s=r(55315),n=/('[^']*(\\.[^'\\]*)*')/,o=/("[^"]*(\\.[^"\\]*)*")/,a=(e,t,r)=>{throw Error("Missing value for statement.\n"+e+" not provided for statement:\n"+t+"\nthis was provided:\n"+JSON.stringify(r))};e.exports=(t,r={})=>i.readdirSync(t).filter(e=>e.endsWith(".sql")).map(e=>({name:e,content:i.readFileSync(s.resolve(t,e),"utf8").replace(/\r\n/g,"\n")})).reduce((t,i)=>(t[i.name]=i.content,i.content.split("\n\n").reduce((e,t)=>(t.trim().startsWith("--")?e.push(t):e.length&&(e[e.length-1]+="\n\n"+t),e),[]).forEach(i=>{if(i.trim().startsWith("--")){let s=i.split("\n")[0].trim().substring(2).trim();if(t[s])throw Error('Duplicate SQL query name "'+s+'" found, please rename other one.');t[s]=r.type?e.exports[r.type](i,r):i}}),t),{}),e.exports.pg=(e,t={})=>(r={})=>{let i=[];return{text:e.replace(/--.*$/gm,"").replace(/\/\*(\*(?!\/)|[^*])*\*\//g,"").split(n).map(s=>!s||n.test(s)?s:s.split(o).map(s=>!s||o.test(s)?s:s.replace(/(::?)([a-zA-Z0-9_]+)/g,(s,n,o)=>":"!==n?n+o:o in r?(i.push(r[o]),"$"+i.length):t.useNullForMissing?(i.push(null),"$"+i.length):a(o,e,r))).join("")).join("").trim(),values:i}},e.exports.mysql=(e,t={})=>(r={})=>{let i=[];return{sql:e.split(n).map(s=>!s||n.test(s)?s:s.split(o).map(s=>!s||o.test(s)?s:s.replace(/(::?)([a-zA-Z0-9_]+)/g,(s,n,o)=>o in r?(i.push(r[o]),n.replace(/:/g,"?")):t.useNullForMissing?(i.push(null),n.replace(/:/g,"?")):a(o,e,r))).join("")).join("").trim(),values:i}}},98102:(e,t,r)=>{"use strict";r.a(e,async(e,i)=>{try{r.r(t),r.d(t,{POST:()=>u});var s=r(19500),n=r(87070),o=r(31059),a=r(65655),l=e([s]);let d=new(s=(l.then?(await l)():l)[0]).D({databaseUrl:process.env.DATABASE_URL,stripeSecretKey:process.env.STRIPE_SECRET_KEY,stripeWebhookSecret:process.env.STRIPE_WEBHOOK_SECRET,backfillRelatedEntities:!0,schema:"stripe"}),h=new o.Z(process.env.STRIPE_SECRET_KEY);async function c(e,t){var r;let i=(0,a.o)(),{data:s,error:n}=await i.from("user_profiles").select("id").eq("stripe_customer_id",e).single();if(!s||n){console.error("User not found for customer:",e);return}let o=t.items.data[0].price.id,l=(await h.prices.retrieve(o,{expand:["product"]})).product,c=(r=l.metadata,{pageviews_limit:parseInt(r.pageviews_limit||"0"),max_websites:parseInt(r.max_websites||"0"),max_total_tracked_pages:parseInt(r.max_total_tracked_pages||"0"),data_retention_days:parseInt(r.data_retention_days||"0")}),u=l.name?.toLowerCase()||"unknown",{error:d}=await i.from("user_profiles").update({current_plan:u,subscription_status:t.status,subscription_current_period_end:new Date(1e3*t.current_period_end),subscription_trial_end:t.trial_end?new Date(1e3*t.trial_end):null,...c}).eq("id",s.id);d&&console.error("Failed to update user plan limits:",d)}async function u(e){let t=await e.text(),r=e.headers.get("stripe-signature");try{let e=h.webhooks.constructEvent(t,r,process.env.STRIPE_WEBHOOK_SECRET);try{await d.processWebhook(t,r)}catch(e){if(!(e instanceof Error&&e.message.includes("Unhandled webhook event")))return console.error("Stripe Sync error:",e),new n.NextResponse("Stripe Sync error",{status:400})}switch(e.type){case"checkout.session.completed":{let t=e.data.object,r=t.customer,i=t.client_reference_id;if(console.log(i,r),i&&r){let e=(0,a.o)(),{data:t,error:s}=await e.from("user_profiles").select("stripe_customer_id").eq("id",i).single();if(!s&&t&&!t.stripe_customer_id){let{error:t}=await e.from("user_profiles").update({stripe_customer_id:r}).eq("id",i);t&&console.error("Error updating user profile with customer ID:",t)}}break}case"customer.subscription.created":case"customer.subscription.updated":{let t=e.data.object;await c(t.customer,t);break}case"customer.subscription.deleted":{let t=e.data.object.customer,r=(0,a.o)(),{data:i,error:s}=await r.from("user_profiles").select("id").eq("stripe_customer_id",t).single();if(i&&!s){let{error:e}=await r.from("user_profiles").update({is_locked:!0,subscription_status:"canceled",subscription_current_period_end:null}).eq("id",i.id);e&&console.error("Error locking user account:",e)}}}return new n.NextResponse("Stripe webhook processed",{status:200})}catch(e){return console.error("Stripe webhook error:",e),new n.NextResponse("Stripe webhook error",{status:400})}}i()}catch(e){i(e)}})},65655:(e,t,r)=>{"use strict";r.d(t,{e:()=>n,o:()=>o});var i=r(68005),s=r(71615);let n=()=>{let e=(0,s.cookies)();return(0,i.createServerClient)("https://rkrkpchutofbpyqvniqq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJrcmtwY2h1dG9mYnB5cXZuaXFxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI2NjQxMDEsImV4cCI6MjA2ODI0MDEwMX0.ZwRskqebH9S5St7QH3d4-fhQ8u4MzBng6bWYA0MlQnw",{cookies:{getAll:()=>e.getAll(),setAll(t){try{t.forEach(({name:t,value:r,options:i})=>{e.set(t,r,i)})}catch(e){}}}})};function o(){let e=process.env.SUPABASE_SERVICE_ROLE_KEY;return(0,i.createServerClient)("https://rkrkpchutofbpyqvniqq.supabase.co",e,{cookies:{getAll:()=>[],setAll:()=>{}},auth:{autoRefreshToken:!1,persistSession:!1}})}},19500:(e,t,r)=>{"use strict";r.a(e,async(e,i)=>{try{r.d(t,{D:()=>k});var s=r(31059),n=r(4820),o=r(8678);r(78052),r(92048),r(55315);var a=e([o]);o=(a.then?(await a)():a)[0];var l=class{constructor(e){this.config=e,this.pool=new o.default.Pool({connectionString:e.databaseUrl,max:e.maxConnections||10,keepAlive:!0})}pool;async delete(e,t){let r=(0,n.pg)(`
    delete from "${this.config.schema}"."${e}" 
    where id = :id
    returning id;
    `)({id:t}),{rows:i}=await this.query(r.text,r.values);return i.length>0}async query(e,t){return this.pool.query(e,t)}async upsertMany(e,t,r){if(!e.length)return[];let i=[];for(let s=0;s<e.length;s+=5){let o=e.slice(s,s+5),a=[];o.forEach(e=>{let i=this.cleanseArrayField(e),s=this.constructUpsertSql(this.config.schema,t,r),o=(0,n.pg)(s,{useNullForMissing:!0})(i);a.push(this.pool.query(o.text,o.values))}),i.push(...await Promise.all(a))}return i.flatMap(e=>e.rows)}async findMissingEntries(e,t){if(!t.length)return[];let r=(0,n.pg)(`
    select id from "${this.config.schema}"."${e}"
    where id=any(:ids::text[]);
    `)({ids:t}),{rows:i}=await this.query(r.text,r.values),s=i.map(e=>e.id);return t.filter(e=>!s.includes(e))}constructUpsertSql(e,t,r,i){let{conflict:s="id"}=i||{},n=r.properties;return`
    insert into "${e}"."${t}" (
      ${n.map(e=>`"${e}"`).join(",")}
    )
    values (
      ${n.map(e=>`:${e}`).join(",")}
    )
    on conflict (
      ${s}
    )
    do update set 
      ${n.map(e=>`"${e}" = :${e}`).join(",")}
    ;`}cleanseArrayField(e){let t={...e};return Object.keys(t).map(e=>{let r=t[e];Array.isArray(r)&&(t[e]=JSON.stringify(r))}),t}},c={properties:["id","object","paid","order","amount","review","source","status","created","dispute","invoice","outcome","refunds","captured","currency","customer","livemode","metadata","refunded","shipping","application","description","destination","failure_code","on_behalf_of","fraud_details","receipt_email","payment_intent","receipt_number","transfer_group","amount_refunded","application_fee","failure_message","source_transfer","balance_transaction","statement_descriptor","payment_method_details"]},u={properties:["id","object","amount","amount_shipping","created","currency","customer","customer_balance_transaction","discount_amount","discount_amounts","invoice","lines","livemode","memo","metadata","number","out_of_band_amount","pdf","reason","refund","shipping_cost","status","subtotal","subtotal_excluding_tax","tax_amounts","total","total_excluding_tax","type","voided_at"]},d={properties:["id","object","address","description","email","metadata","name","phone","shipping","balance","created","currency","default_source","delinquent","discount","invoice_prefix","invoice_settings","livemode","next_invoice_sequence","preferred_locales","tax_exempt"]},h={properties:["id","object","deleted"]},p={properties:["id","object","amount","charge","created","currency","balance_transactions","evidence","evidence_details","is_charge_refundable","livemode","metadata","payment_intent","reason","status"]},m={properties:["id","object","auto_advance","collection_method","currency","description","hosted_invoice_url","lines","metadata","period_end","period_start","status","total","account_country","account_name","account_tax_ids","amount_due","amount_paid","amount_remaining","application_fee_amount","attempt_count","attempted","billing_reason","created","custom_fields","customer_address","customer_email","customer_name","customer_phone","customer_shipping","customer_tax_exempt","customer_tax_ids","default_tax_rates","discount","discounts","due_date","ending_balance","footer","invoice_pdf","last_finalization_error","livemode","next_payment_attempt","number","paid","payment_settings","post_payment_credit_notes_amount","pre_payment_credit_notes_amount","receipt_number","starting_balance","statement_descriptor","status_transitions","subtotal","tax","total_discount_amounts","total_tax_amounts","transfer_data","webhooks_delivered_at","customer","subscription","payment_intent","default_payment_method","default_source","on_behalf_of","charge"]},f={properties:["id","object","active","amount","created","product","currency","interval","livemode","metadata","nickname","tiers_mode","usage_type","billing_scheme","interval_count","aggregate_usage","transform_usage","trial_period_days"]},y={properties:["id","object","active","currency","metadata","nickname","recurring","type","unit_amount","billing_scheme","created","livemode","lookup_key","tiers_mode","transform_quantity","unit_amount_decimal","product"]},g={properties:["id","object","active","default_price","description","metadata","name","created","images","marketing_features","livemode","package_dimensions","shippable","statement_descriptor","unit_label","updated","url"]},v={properties:["id","object","amount","amount_capturable","amount_details","amount_received","application","application_fee_amount","automatic_payment_methods","canceled_at","cancellation_reason","capture_method","client_secret","confirmation_method","created","currency","customer","description","invoice","last_payment_error","livemode","metadata","next_action","on_behalf_of","payment_method","payment_method_options","payment_method_types","processing","receipt_email","review","setup_future_usage","shipping","statement_descriptor","statement_descriptor_suffix","status","transfer_data","transfer_group"]},_={properties:["id","object","created","customer","type","billing_details","metadata","card"]},P={properties:["id","object","created","customer","description","payment_method","status","usage","cancellation_reason","latest_attempt","mandate","single_use_mandate","on_behalf_of"]},b={properties:["id","country","customer","type","value","object","created","livemode","owner"]},T={properties:["id","object","billing_thresholds","created","deleted","metadata","quantity","price","subscription","tax_rates"]},E={properties:["id","object","application","canceled_at","completed_at","created","current_phase","customer","default_settings","end_behavior","livemode","metadata","phases","released_at","released_subscription","status","subscription","test_clock"]},S={properties:["id","object","cancel_at_period_end","current_period_end","current_period_start","default_payment_method","items","metadata","pending_setup_intent","pending_update","status","application_fee_percent","billing_cycle_anchor","billing_thresholds","cancel_at","canceled_at","collection_method","created","days_until_due","default_source","default_tax_rates","discount","ended_at","livemode","next_pending_invoice_item_invoice","pause_collection","pending_invoice_item_interval","start_date","transfer_data","trial_end","trial_start","schedule","customer","latest_invoice","plan"]},w={properties:["id","object","actionable","charge","created","fraud_type","livemode","payment_intent"]},x={properties:["id","object","billing_zip","created","charge","closed_reason","livemode","ip_address","ip_address_location","open","opened_reason","payment_intent","reason","session"]},O={properties:["id","object","amount","balance_transaction","charge","created","currency","destination_details","metadata","payment_intent","reason","receipt_number","source_transfer_reversal","status","transfer_reversal"]};function A(e,t){let r=new Set(e.map(e=>e?.[t]?.toString()).filter(e=>!!e));return Array.from(r)}var k=class{constructor(e){this.config=e,this.stripe=new s.Z(e.stripeSecretKey,{apiVersion:e.stripeApiVersion,appInfo:{name:"Stripe Postgres Sync"}}),this.config.logger?.info({autoExpandLists:e.autoExpandLists,stripeApiVersion:e.stripeApiVersion},"StripeSync initialized"),this.postgresClient=new l({databaseUrl:e.databaseUrl,schema:e.schema||"stripe",maxConnections:e.maxPostgresConnections})}stripe;postgresClient;async processWebhook(e,t){let r=await this.stripe.webhooks.constructEventAsync(e,t,this.config.stripeWebhookSecret);switch(r.type){case"charge.captured":case"charge.expired":case"charge.failed":case"charge.pending":case"charge.refunded":case"charge.succeeded":case"charge.updated":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.charges.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for charge ${e.id}`),await this.upsertCharges([e]);break}case"customer.created":case"customer.deleted":case"customer.updated":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.customers.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for customer ${e.id}`),await this.upsertCustomers([e]);break}case"customer.subscription.created":case"customer.subscription.deleted":case"customer.subscription.paused":case"customer.subscription.pending_update_applied":case"customer.subscription.pending_update_expired":case"customer.subscription.trial_will_end":case"customer.subscription.resumed":case"customer.subscription.updated":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.subscriptions.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for subscription ${e.id}`),await this.upsertSubscriptions([e]);break}case"customer.tax_id.updated":case"customer.tax_id.created":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.taxIds.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for taxId ${e.id}`),await this.upsertTaxIds([e]);break}case"customer.tax_id.deleted":{let e=r.data.object;this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for taxId ${e.id}`),await this.deleteTaxId(e.id);break}case"invoice.created":case"invoice.deleted":case"invoice.finalized":case"invoice.finalization_failed":case"invoice.paid":case"invoice.payment_action_required":case"invoice.payment_failed":case"invoice.payment_succeeded":case"invoice.upcoming":case"invoice.sent":case"invoice.voided":case"invoice.marked_uncollectible":case"invoice.updated":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.invoices.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for invoice ${e.id}`),await this.upsertInvoices([e]);break}case"product.created":case"product.updated":try{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.products.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for product ${e.id}`),await this.upsertProducts([e])}catch(e){if(e instanceof s.Z.errors.StripeAPIError&&"resource_missing"===e.code)await this.deleteProduct(r.data.object.id);else throw e}break;case"product.deleted":{let e=r.data.object;this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for product ${e.id}`),await this.deleteProduct(e.id);break}case"price.created":case"price.updated":try{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.prices.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for price ${e.id}`),await this.upsertPrices([e])}catch(e){if(e instanceof s.Z.errors.StripeAPIError&&"resource_missing"===e.code)await this.deletePrice(r.data.object.id);else throw e}break;case"price.deleted":{let e=r.data.object;this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for price ${e.id}`),await this.deletePrice(e.id);break}case"plan.created":case"plan.updated":try{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.plans.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for plan ${e.id}`),await this.upsertPlans([e])}catch(e){if(e instanceof s.Z.errors.StripeAPIError&&"resource_missing"===e.code)await this.deletePlan(r.data.object.id);else throw e}break;case"plan.deleted":{let e=r.data.object;this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for plan ${e.id}`),await this.deletePlan(e.id);break}case"setup_intent.canceled":case"setup_intent.created":case"setup_intent.requires_action":case"setup_intent.setup_failed":case"setup_intent.succeeded":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.setupIntents.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for setupIntent ${e.id}`),await this.upsertSetupIntents([e]);break}case"subscription_schedule.aborted":case"subscription_schedule.canceled":case"subscription_schedule.completed":case"subscription_schedule.created":case"subscription_schedule.expiring":case"subscription_schedule.released":case"subscription_schedule.updated":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.subscriptionSchedules.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for subscriptionSchedule ${e.id}`),await this.upsertSubscriptionSchedules([e]);break}case"payment_method.attached":case"payment_method.automatically_updated":case"payment_method.detached":case"payment_method.updated":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.paymentMethods.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for paymentMethod ${e.id}`),await this.upsertPaymentMethods([e]);break}case"charge.dispute.created":case"charge.dispute.funds_reinstated":case"charge.dispute.funds_withdrawn":case"charge.dispute.updated":case"charge.dispute.closed":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.disputes.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for dispute ${e.id}`),await this.upsertDisputes([e]);break}case"payment_intent.amount_capturable_updated":case"payment_intent.canceled":case"payment_intent.created":case"payment_intent.partially_funded":case"payment_intent.payment_failed":case"payment_intent.processing":case"payment_intent.requires_action":case"payment_intent.succeeded":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.paymentIntents.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for paymentIntent ${e.id}`),await this.upsertPaymentIntents([e]);break}case"credit_note.created":case"credit_note.updated":case"credit_note.voided":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.creditNotes.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for creditNote ${e.id}`),await this.upsertCreditNotes([e]);break}case"radar.early_fraud_warning.created":case"radar.early_fraud_warning.updated":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.radar.earlyFraudWarnings.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for earlyFraudWarning ${e.id}`),await this.upsertEarlyFraudWarning([e]);break}case"refund.created":case"refund.failed":case"refund.updated":case"charge.refund.updated":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.refunds.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for refund ${e.id}`),await this.upsertRefunds([e]);break}case"review.closed":case"review.opened":{let e=await this.fetchOrUseWebhookData(r.data.object,e=>this.stripe.reviews.retrieve(e));this.config.logger?.info(`Received webhook ${r.id}: ${r.type} for review ${e.id}`),await this.upsertReviews([e]);break}default:throw Error("Unhandled webhook event")}}async fetchOrUseWebhookData(e,t){return e.id&&this.config.revalidateEntityViaStripeApi?t(e.id):e}async syncSingleEntity(e){if(e.startsWith("cus_"))return this.stripe.customers.retrieve(e).then(e=>{if(e&&!e.deleted)return this.upsertCustomers([e])});if(e.startsWith("in_"))return this.stripe.invoices.retrieve(e).then(e=>this.upsertInvoices([e]));if(e.startsWith("price_"))return this.stripe.prices.retrieve(e).then(e=>this.upsertPrices([e]));if(e.startsWith("prod_"))return this.stripe.products.retrieve(e).then(e=>this.upsertProducts([e]));if(e.startsWith("sub_"))return this.stripe.subscriptions.retrieve(e).then(e=>this.upsertSubscriptions([e]));if(e.startsWith("seti_"))return this.stripe.setupIntents.retrieve(e).then(e=>this.upsertSetupIntents([e]));if(e.startsWith("pm_"))return this.stripe.paymentMethods.retrieve(e).then(e=>this.upsertPaymentMethods([e]));else if(e.startsWith("dp_")||e.startsWith("du_"))return this.stripe.disputes.retrieve(e).then(e=>this.upsertDisputes([e]));else if(e.startsWith("ch_"))return this.stripe.charges.retrieve(e).then(e=>this.upsertCharges([e],!0));else if(e.startsWith("pi_"))return this.stripe.paymentIntents.retrieve(e).then(e=>this.upsertPaymentIntents([e]));else if(e.startsWith("txi_"))return this.stripe.taxIds.retrieve(e).then(e=>this.upsertTaxIds([e]));else if(e.startsWith("cn_"))return this.stripe.creditNotes.retrieve(e).then(e=>this.upsertCreditNotes([e]));else if(e.startsWith("issfr_"))return this.stripe.radar.earlyFraudWarnings.retrieve(e).then(e=>this.upsertEarlyFraudWarning([e]));else if(e.startsWith("prv_"))return this.stripe.reviews.retrieve(e).then(e=>this.upsertReviews([e]));else if(e.startsWith("re_"))return this.stripe.refunds.retrieve(e).then(e=>this.upsertRefunds([e]))}async syncBackfill(e){let t,r,i,s,n,o,a,l,c,u,d,h,p,m,f,y;let{object:g}=e??{};switch(g){case"all":t=await this.syncProducts(e),r=await this.syncPrices(e),h=await this.syncPlans(e),i=await this.syncCustomers(e),s=await this.syncSubscriptions(e),n=await this.syncSubscriptionSchedules(e),o=await this.syncInvoices(e),u=await this.syncCharges(e),a=await this.syncSetupIntents(e),l=await this.syncPaymentMethods(e),d=await this.syncPaymentIntents(e),p=await this.syncTaxIds(e),m=await this.syncCreditNotes(e),c=await this.syncDisputes(e),f=await this.syncEarlyFraudWarnings(e),y=await this.syncRefunds(e);break;case"customer":i=await this.syncCustomers(e);break;case"invoice":o=await this.syncInvoices(e);break;case"price":r=await this.syncPrices(e);break;case"product":t=await this.syncProducts(e);break;case"subscription":s=await this.syncSubscriptions(e);break;case"subscription_schedules":n=await this.syncSubscriptionSchedules(e);break;case"setup_intent":a=await this.syncSetupIntents(e);break;case"payment_method":l=await this.syncPaymentMethods(e);break;case"dispute":c=await this.syncDisputes(e);break;case"charge":u=await this.syncCharges(e);break;case"payment_intent":d=await this.syncPaymentIntents(e);case"plan":h=await this.syncPlans(e);break;case"tax_id":p=await this.syncTaxIds(e);break;case"credit_note":m=await this.syncCreditNotes(e);break;case"early_fraud_warning":f=await this.syncEarlyFraudWarnings(e);break;case"refund":y=await this.syncRefunds(e)}return{products:t,prices:r,customers:i,subscriptions:s,subscriptionSchedules:n,invoices:o,setupIntents:a,paymentMethods:l,disputes:c,charges:u,paymentIntents:d,plans:h,taxIds:p,creditNotes:m,earlyFraudWarnings:f,refunds:y}}async syncProducts(e){this.config.logger?.info("Syncing products");let t={limit:100};return e?.created&&(t.created=e?.created),this.fetchAndUpsert(()=>this.stripe.products.list(t),e=>this.upsertProducts(e))}async syncPrices(e){this.config.logger?.info("Syncing prices");let t={limit:100};return e?.created&&(t.created=e?.created),this.fetchAndUpsert(()=>this.stripe.prices.list(t),t=>this.upsertPrices(t,e?.backfillRelatedEntities))}async syncPlans(e){this.config.logger?.info("Syncing plans");let t={limit:100};return e?.created&&(t.created=e?.created),this.fetchAndUpsert(()=>this.stripe.plans.list(t),t=>this.upsertPlans(t,e?.backfillRelatedEntities))}async syncCustomers(e){this.config.logger?.info("Syncing customers");let t={limit:100};return e?.created&&(t.created=e.created),this.fetchAndUpsert(()=>this.stripe.customers.list(t),e=>this.upsertCustomers(e))}async syncSubscriptions(e){this.config.logger?.info("Syncing subscriptions");let t={status:"all",limit:100};return e?.created&&(t.created=e.created),this.fetchAndUpsert(()=>this.stripe.subscriptions.list(t),t=>this.upsertSubscriptions(t,e?.backfillRelatedEntities))}async syncSubscriptionSchedules(e){this.config.logger?.info("Syncing subscription schedules");let t={limit:100};return e?.created&&(t.created=e.created),this.fetchAndUpsert(()=>this.stripe.subscriptionSchedules.list(t),t=>this.upsertSubscriptionSchedules(t,e?.backfillRelatedEntities))}async syncInvoices(e){this.config.logger?.info("Syncing invoices");let t={limit:100};return e?.created&&(t.created=e.created),this.fetchAndUpsert(()=>this.stripe.invoices.list(t),t=>this.upsertInvoices(t,e?.backfillRelatedEntities))}async syncCharges(e){this.config.logger?.info("Syncing charges");let t={limit:100};return e?.created&&(t.created=e.created),this.fetchAndUpsert(()=>this.stripe.charges.list(t),t=>this.upsertCharges(t,e?.backfillRelatedEntities))}async syncSetupIntents(e){this.config.logger?.info("Syncing setup_intents");let t={limit:100};return e?.created&&(t.created=e.created),this.fetchAndUpsert(()=>this.stripe.setupIntents.list(t),t=>this.upsertSetupIntents(t,e?.backfillRelatedEntities))}async syncPaymentIntents(e){this.config.logger?.info("Syncing payment_intents");let t={limit:100};return e?.created&&(t.created=e.created),this.fetchAndUpsert(()=>this.stripe.paymentIntents.list(t),t=>this.upsertPaymentIntents(t,e?.backfillRelatedEntities))}async syncTaxIds(e){this.config.logger?.info("Syncing tax_ids");let t={limit:100};return this.fetchAndUpsert(()=>this.stripe.taxIds.list(t),t=>this.upsertTaxIds(t,e?.backfillRelatedEntities))}async syncPaymentMethods(e){this.config.logger?.info("Syncing payment method");let t=(0,n.pg)(`select id from "${this.config.schema}"."customers" WHERE deleted <> true;`)([]),r=await this.postgresClient.query(t.text,t.values).then(({rows:e})=>e.map(e=>e.id));this.config.logger?.info(`Getting payment methods for ${r.length} customers`);let i=0;for(let t of function(e,t){let r=[];for(let t=0;t<e.length;t+=10)r.push(e.slice(t,t+10));return r}(r,10))await Promise.all(t.map(async t=>{let r=await this.fetchAndUpsert(()=>this.stripe.paymentMethods.list({limit:100,customer:t}),t=>this.upsertPaymentMethods(t,e?.backfillRelatedEntities));i+=r.synced}));return{synced:i}}async syncDisputes(e){let t={limit:100};return e?.created&&(t.created=e.created),this.fetchAndUpsert(()=>this.stripe.disputes.list(t),t=>this.upsertDisputes(t,e?.backfillRelatedEntities))}async syncEarlyFraudWarnings(e){this.config.logger?.info("Syncing early fraud warnings");let t={limit:100};return e?.created&&(t.created=e.created),this.fetchAndUpsert(()=>this.stripe.radar.earlyFraudWarnings.list(t),t=>this.upsertEarlyFraudWarning(t,e?.backfillRelatedEntities))}async syncRefunds(e){this.config.logger?.info("Syncing refunds");let t={limit:100};return e?.created&&(t.created=e.created),this.fetchAndUpsert(()=>this.stripe.refunds.list(t),t=>this.upsertRefunds(t,e?.backfillRelatedEntities))}async syncCreditNotes(e){this.config.logger?.info("Syncing credit notes");let t={limit:100};return e?.created&&(t.created=e?.created),this.fetchAndUpsert(()=>this.stripe.creditNotes.list(t),e=>this.upsertCreditNotes(e))}async fetchAndUpsert(e,t){let r=[];for await(let t of(this.config.logger?.info("Fetching items to sync from Stripe"),e()))r.push(t);if(!r.length)return{synced:0};this.config.logger?.info(`Upserting ${r.length} items`);for(let e=0;e<r.length;e+=250){let i=r.slice(e,e+250);await t(i)}return this.config.logger?.info("Upserted items"),{synced:r.length}}async upsertCharges(e,t){return(t??this.config.backfillRelatedEntities)&&await Promise.all([this.backfillCustomers(A(e,"customer")),this.backfillInvoices(A(e,"invoice"))]),await this.expandEntity(e,"refunds",e=>this.stripe.refunds.list({charge:e,limit:100})),this.postgresClient.upsertMany(e,"charges",c)}async backfillCharges(e){let t=await this.postgresClient.findMissingEntries("charges",e);await this.fetchMissingEntities(t,e=>this.stripe.charges.retrieve(e)).then(e=>this.upsertCharges(e))}async backfillPaymentIntents(e){let t=await this.postgresClient.findMissingEntries("payment_intents",e);await this.fetchMissingEntities(t,e=>this.stripe.paymentIntents.retrieve(e)).then(e=>this.upsertPaymentIntents(e))}async upsertCreditNotes(e,t){return(t??this.config.backfillRelatedEntities)&&await Promise.all([this.backfillCustomers(A(e,"customer")),this.backfillInvoices(A(e,"invoice"))]),await this.expandEntity(e,"lines",e=>this.stripe.creditNotes.listLineItems(e,{limit:100})),this.postgresClient.upsertMany(e,"credit_notes",u)}async upsertEarlyFraudWarning(e,t){return(t??this.config.backfillRelatedEntities)&&await Promise.all([this.backfillPaymentIntents(A(e,"payment_intent")),this.backfillCharges(A(e,"charge"))]),this.postgresClient.upsertMany(e,"early_fraud_warnings",w)}async upsertRefunds(e,t){return(t??this.config.backfillRelatedEntities)&&await Promise.all([this.backfillPaymentIntents(A(e,"payment_intent")),this.backfillCharges(A(e,"charge"))]),this.postgresClient.upsertMany(e,"refunds",O)}async upsertReviews(e,t){return(t??this.config.backfillRelatedEntities)&&await Promise.all([this.backfillPaymentIntents(A(e,"payment_intent")),this.backfillCharges(A(e,"charge"))]),this.postgresClient.upsertMany(e,"reviews",x)}async upsertCustomers(e){let t=e.filter(e=>e.deleted),r=e.filter(e=>!e.deleted);return await this.postgresClient.upsertMany(r,"customers",d),await this.postgresClient.upsertMany(t,"customers",h),e}async backfillCustomers(e){let t=await this.postgresClient.findMissingEntries("customers",e);await this.fetchMissingEntities(t,e=>this.stripe.customers.retrieve(e)).then(e=>this.upsertCustomers(e)).catch(e=>{throw this.config.logger?.error(e,"Failed to backfill"),e})}async upsertDisputes(e,t){return(t??this.config.backfillRelatedEntities)&&await this.backfillCharges(A(e,"charge")),this.postgresClient.upsertMany(e,"disputes",p)}async upsertInvoices(e,t){return(t??this.config.backfillRelatedEntities)&&await Promise.all([this.backfillCustomers(A(e,"customer")),this.backfillSubscriptions(A(e,"subscription"))]),await this.expandEntity(e,"lines",e=>this.stripe.invoices.listLineItems(e,{limit:100})),this.postgresClient.upsertMany(e,"invoices",m)}backfillInvoices=async e=>{let t=await this.postgresClient.findMissingEntries("invoices",e);await this.fetchMissingEntities(t,e=>this.stripe.invoices.retrieve(e)).then(e=>this.upsertInvoices(e))};async upsertPlans(e,t){return(t??this.config.backfillRelatedEntities)&&await this.backfillProducts(A(e,"product")),this.postgresClient.upsertMany(e,"plans",f)}async deletePlan(e){return this.postgresClient.delete("plans",e)}async upsertPrices(e,t){return(t??this.config.backfillRelatedEntities)&&await this.backfillProducts(A(e,"product")),this.postgresClient.upsertMany(e,"prices",y)}async deletePrice(e){return this.postgresClient.delete("prices",e)}async upsertProducts(e){return this.postgresClient.upsertMany(e,"products",g)}async deleteProduct(e){return this.postgresClient.delete("products",e)}async backfillProducts(e){let t=await this.postgresClient.findMissingEntries("products",e);await this.fetchMissingEntities(t,e=>this.stripe.products.retrieve(e)).then(e=>this.upsertProducts(e))}async upsertPaymentIntents(e,t){return(t??this.config.backfillRelatedEntities)&&await Promise.all([this.backfillCustomers(A(e,"customer")),this.backfillInvoices(A(e,"invoice"))]),this.postgresClient.upsertMany(e,"payment_intents",v)}async upsertPaymentMethods(e,t=!1){return(t??this.config.backfillRelatedEntities)&&await this.backfillCustomers(A(e,"customer")),this.postgresClient.upsertMany(e,"payment_methods",_)}async upsertSetupIntents(e,t){return(t??this.config.backfillRelatedEntities)&&await this.backfillCustomers(A(e,"customer")),this.postgresClient.upsertMany(e,"setup_intents",P)}async upsertTaxIds(e,t){return(t??this.config.backfillRelatedEntities)&&await this.backfillCustomers(A(e,"customer")),this.postgresClient.upsertMany(e,"tax_ids",b)}async deleteTaxId(e){return this.postgresClient.delete("tax_ids",e)}async upsertSubscriptionItems(e){let t=e.map(e=>{let t=e.price.id.toString(),r=e.deleted,i=e.quantity;return{...e,price:t,deleted:r??!1,quantity:i??null}});await this.postgresClient.upsertMany(t,"subscription_items",T)}async markDeletedSubscriptionItems(e,t){let r=(0,n.pg)(`
    select id from "${this.config.schema}"."subscription_items"
    where subscription = :subscriptionId and deleted = false;
    `)({subscriptionId:e}),{rows:i}=await this.postgresClient.query(r.text,r.values),s=i.filter(({id:e})=>!1===t.includes(e));if(!(s.length>0))return{rowCount:0};{let e=s.map(({id:e})=>e);r=(0,n.pg)(`
      update "${this.config.schema}"."subscription_items"
      set deleted = true where id=any(:ids::text[]);
      `)({ids:e});let{rowCount:t}=await await this.postgresClient.query(r.text,r.values);return{rowCount:t||0}}}async upsertSubscriptionSchedules(e,t){if(t??this.config.backfillRelatedEntities){let t=A(e,"customer");await this.backfillCustomers(t)}return await this.postgresClient.upsertMany(e,"subscription_schedules",E)}async upsertSubscriptions(e,t){if(t??this.config.backfillRelatedEntities){let t=A(e,"customer");await this.backfillCustomers(t)}await this.expandEntity(e,"items",e=>this.stripe.subscriptionItems.list({subscription:e,limit:100}));let r=await this.postgresClient.upsertMany(e,"subscriptions",S),i=e.flatMap(e=>e.items.data);await this.upsertSubscriptionItems(i);let s=[];for(let t of e){let e=t.items.data.map(e=>e.id);s.push(this.markDeletedSubscriptionItems(t.id,e))}return await Promise.all(s),r}async backfillSubscriptions(e){let t=await this.postgresClient.findMissingEntries("subscriptions",e);await this.fetchMissingEntities(t,e=>this.stripe.subscriptions.retrieve(e)).then(e=>this.upsertSubscriptions(e))}backfillSubscriptionSchedules=async e=>{let t=await this.postgresClient.findMissingEntries("subscription_schedules",e);await this.fetchMissingEntities(t,e=>this.stripe.subscriptionSchedules.retrieve(e)).then(e=>this.upsertSubscriptionSchedules(e))};async expandEntity(e,t,r){if(this.config.autoExpandLists){for(let i of e)if(i[t]?.has_more){let e=[];for await(let t of r(i.id))e.push(t);i[t]={...i[t],data:e,has_more:!1}}}}async fetchMissingEntities(e,t){if(!e.length)return[];let r=[];for(let i of e){let e=await t(i);r.push(e)}return r}};i()}catch(e){i(e)}})},31059:(e,t,r)=>{"use strict";r.d(t,{Z:()=>sH});var i={};r.r(i),r.d(i,{StripeAPIError:()=>K,StripeAuthenticationError:()=>V,StripeCardError:()=>z,StripeConnectionError:()=>X,StripeError:()=>W,StripeIdempotencyError:()=>Z,StripeInvalidGrantError:()=>ee,StripeInvalidRequestError:()=>B,StripePermissionError:()=>J,StripeRateLimitError:()=>Q,StripeSignatureVerificationError:()=>Y,StripeUnknownError:()=>et,TemporarySessionExpiredError:()=>er,generateV1Error:()=>L,generateV2Error:()=>H});var s={};r.r(s),r.d(s,{Account:()=>rq,AccountLinks:()=>rU,AccountSessions:()=>rL,Accounts:()=>rq,ApplePayDomains:()=>rW,ApplicationFees:()=>rB,Apps:()=>s_,Balance:()=>rV,BalanceTransactions:()=>rQ,Billing:()=>sP,BillingPortal:()=>sb,Charges:()=>rY,Checkout:()=>sT,Climate:()=>sE,ConfirmationTokens:()=>r1,CountrySpecs:()=>r2,Coupons:()=>r8,CreditNotes:()=>r5,CustomerSessions:()=>r9,Customers:()=>ie,Disputes:()=>ir,Entitlements:()=>sS,EphemeralKeys:()=>is,Events:()=>ia,ExchangeRates:()=>ic,FileLinks:()=>id,Files:()=>im,FinancialConnections:()=>sw,Forwarding:()=>sx,Identity:()=>sO,InvoiceItems:()=>ig,InvoicePayments:()=>i_,InvoiceRenderingTemplates:()=>ib,Invoices:()=>iE,Issuing:()=>sA,Mandates:()=>iw,OAuth:()=>iA,PaymentIntents:()=>iC,PaymentLinks:()=>iI,PaymentMethodConfigurations:()=>iG,PaymentMethodDomains:()=>iD,PaymentMethods:()=>iq,Payouts:()=>iU,Plans:()=>iL,Prices:()=>iW,Products:()=>iB,PromotionCodes:()=>iV,Quotes:()=>iQ,Radar:()=>sk,Refunds:()=>iY,Reporting:()=>sC,Reviews:()=>i1,SetupAttempts:()=>i2,SetupIntents:()=>i8,ShippingRates:()=>i5,Sigma:()=>sR,Sources:()=>i9,SubscriptionItems:()=>se,SubscriptionSchedules:()=>sr,Subscriptions:()=>ss,Tax:()=>sI,TaxCodes:()=>so,TaxIds:()=>sl,TaxRates:()=>su,Terminal:()=>sj,TestHelpers:()=>sG,Tokens:()=>sh,Topups:()=>sm,Transfers:()=>sy,Treasury:()=>sM,V2:()=>sD,WebhookEndpoints:()=>sv});var n=r(84770),o=r(17702);class a{computeHMACSignature(e,t){throw Error("computeHMACSignature not implemented.")}computeHMACSignatureAsync(e,t){throw Error("computeHMACSignatureAsync not implemented.")}computeSHA256Async(e){throw Error("computeSHA256 not implemented.")}}class l extends Error{}class c extends a{computeHMACSignature(e,t){return n.createHmac("sha256",t).update(e,"utf8").digest("hex")}async computeHMACSignatureAsync(e,t){return await this.computeHMACSignature(e,t)}async computeSHA256Async(e){return new Uint8Array(await n.createHash("sha256").update(e).digest())}}var u=r(32615),d=r.t(u,2),h=r(35240),p=r.t(h,2);class m{getClientName(){throw Error("getClientName not implemented.")}makeRequest(e,t,r,i,s,n,o,a){throw Error("makeRequest not implemented.")}static makeTimeoutError(){let e=TypeError(m.TIMEOUT_ERROR_CODE);return e.code=m.TIMEOUT_ERROR_CODE,e}}m.CONNECTION_CLOSED_ERROR_CODES=["ECONNRESET","EPIPE"],m.TIMEOUT_ERROR_CODE="ETIMEDOUT";class f{constructor(e,t){this._statusCode=e,this._headers=t}getStatusCode(){return this._statusCode}getHeaders(){return this._headers}getRawResponse(){throw Error("getRawResponse not implemented.")}toStream(e){throw Error("toStream not implemented.")}toJSON(){throw Error("toJSON not implemented.")}}let y=u||d,g=h||p,v=new y.Agent({keepAlive:!0}),_=new g.Agent({keepAlive:!0});class P extends m{constructor(e){super(),this._agent=e}getClientName(){return"node"}makeRequest(e,t,r,i,s,n,o,a){let l="http"===o,c=this._agent;return c||(c=l?v:_),new Promise((o,u)=>{let d=(l?y:g).request({host:e,port:t,path:r,method:i,agent:c,headers:s,ciphers:"DEFAULT:!aNULL:!eNULL:!LOW:!EXPORT:!SSLv2:!MD5"});d.setTimeout(a,()=>{d.destroy(m.makeTimeoutError())}),d.on("response",e=>{o(new b(e))}),d.on("error",e=>{u(e)}),d.once("socket",e=>{e.connecting?e.once(l?"connect":"secureConnect",()=>{d.write(n),d.end()}):(d.write(n),d.end())})})}}class b extends f{constructor(e){super(e.statusCode,e.headers||{}),this._res=e}getRawResponse(){return this._res}toStream(e){return this._res.once("end",()=>e()),this._res}toJSON(){return new Promise((e,t)=>{let r="";this._res.setEncoding("utf8"),this._res.on("data",e=>{r+=e}),this._res.once("end",()=>{try{e(JSON.parse(r))}catch(e){t(e)}})})}}var T=r(6684);let E=["apiKey","idempotencyKey","stripeAccount","apiVersion","maxNetworkRetries","timeout","host","authenticator","stripeContext","additionalHeaders","streaming"];function S(e){return e&&"object"==typeof e&&E.some(t=>Object.prototype.hasOwnProperty.call(e,t))}function w(e,t){return T.stringify(e,{serializeDate:e=>Math.floor(e.getTime()/1e3).toString(),arrayFormat:"v2"==t?"repeat":"indices"}).replace(/%5B/g,"[").replace(/%5D/g,"]")}let x=(()=>{let e={"\n":"\\n",'"':'\\"',"\u2028":"\\u2028","\u2029":"\\u2029"};return t=>{let r=t.replace(/["\n\r\u2028\u2029]/g,t=>e[t]);return e=>r.replace(/\{([\s\S]+?)\}/g,(t,r)=>{let i=e[r];return["number","string","boolean"].includes(typeof i)?encodeURIComponent(i):""})}})();function O(e){if(!Array.isArray(e)||!e[0]||"object"!=typeof e[0])return{};if(!S(e[0]))return e.shift();let t=Object.keys(e[0]),r=t.filter(e=>E.includes(e));return r.length>0&&r.length!==t.length&&R(`Options found in arguments (${r.join(", ")}). Did you mean to pass an options object? See https://github.com/stripe/stripe-node/wiki/Passing-Options.`),{}}function A(e){let t={host:null,headers:{},settings:{},streaming:!1};if(e.length>0){let r=e[e.length-1];if("string"==typeof r)t.authenticator=j(e.pop());else if(S(r)){let r=Object.assign({},e.pop()),i=Object.keys(r).filter(e=>!E.includes(e));if(i.length&&R(`Invalid options found (${i.join(", ")}); ignoring.`),r.apiKey&&(t.authenticator=j(r.apiKey)),r.idempotencyKey&&(t.headers["Idempotency-Key"]=r.idempotencyKey),r.stripeAccount&&(t.headers["Stripe-Account"]=r.stripeAccount),r.stripeContext){if(t.headers["Stripe-Account"])throw Error("Can't specify both stripeAccount and stripeContext.");t.headers["Stripe-Context"]=r.stripeContext}if(r.apiVersion&&(t.headers["Stripe-Version"]=r.apiVersion),Number.isInteger(r.maxNetworkRetries)&&(t.settings.maxNetworkRetries=r.maxNetworkRetries),Number.isInteger(r.timeout)&&(t.settings.timeout=r.timeout),r.host&&(t.host=r.host),r.authenticator){if(r.apiKey)throw Error("Can't specify both apiKey and authenticator.");if("function"!=typeof r.authenticator)throw Error("The authenticator must be a function receiving a request as the first parameter.");t.authenticator=r.authenticator}r.additionalHeaders&&(t.headers=r.additionalHeaders),r.streaming&&(t.streaming=!0)}}return t}function k(e){if("object"!=typeof e)throw Error("Argument must be an object");return Object.keys(e).reduce((t,r)=>(null!=e[r]&&(t[r]=e[r]),t),{})}function C(e,t){return t?e.then(e=>{setTimeout(()=>{t(null,e)},0)},e=>{setTimeout(()=>{t(e,null)},0)}):e}function R(e){return"function"!=typeof process.emitWarning?console.warn(`Stripe: ${e}`):process.emitWarning(e,"Stripe")}function I(e,t,r){if(!Number.isInteger(t)){if(void 0!==r)return r;throw Error(`${e} must be an integer`)}return t}function j(e){let t=t=>(t.headers.Authorization="Bearer "+e,Promise.resolve());return t._apiKey=e,t}function G(e,t){return this[e]instanceof Date?Math.floor(this[e].getTime()/1e3).toString():t}function M(e){return e&&e.startsWith("/v2")?"v2":"v1"}function D(e){return Array.isArray(e)?e.join(", "):String(e)}class N extends m{constructor(e){if(super(),!e){if(!globalThis.fetch)throw Error("fetch() function not provided and is not defined in the global scope. You must provide a fetch implementation.");e=globalThis.fetch}globalThis.AbortController?this._fetchFn=N.makeFetchWithAbortTimeout(e):this._fetchFn=N.makeFetchWithRaceTimeout(e)}static makeFetchWithRaceTimeout(e){return(t,r,i)=>{let s;let n=new Promise((e,t)=>{s=setTimeout(()=>{s=null,t(m.makeTimeoutError())},i)});return Promise.race([e(t,r),n]).finally(()=>{s&&clearTimeout(s)})}}static makeFetchWithAbortTimeout(e){return async(t,r,i)=>{let s=new AbortController,n=setTimeout(()=>{n=null,s.abort(m.makeTimeoutError())},i);try{return await e(t,Object.assign(Object.assign({},r),{signal:s.signal}))}catch(e){if("AbortError"===e.name)throw m.makeTimeoutError();throw e}finally{n&&clearTimeout(n)}}}getClientName(){return"fetch"}async makeRequest(e,t,r,i,s,n,o,a){let l=new URL(r,`${"http"===o?"http":"https"}://${e}`);l.port=t;let c="POST"==i||"PUT"==i||"PATCH"==i,u=n||(c?"":void 0);return new q(await this._fetchFn(l.toString(),{method:i,headers:Object.entries(s).map(([e,t])=>[e,D(t)]),body:"object"==typeof u?JSON.stringify(u):u},a))}}class q extends f{constructor(e){super(e.status,q._transformHeadersToObject(e.headers)),this._res=e}getRawResponse(){return this._res}toStream(e){return e(),this._res.body}toJSON(){return this._res.json()}static _transformHeadersToObject(e){let t={};for(let r of e){if(!Array.isArray(r)||2!=r.length)throw Error("Response objects produced by the fetch function given to FetchHttpClient do not have an iterable headers map. Response#headers should be an iterable object.");t[r[0]]=r[1]}return t}}class $ extends a{constructor(e){super(),this.subtleCrypto=e||crypto.subtle}computeHMACSignature(e,t){throw new l("SubtleCryptoProvider cannot be used in a synchronous context.")}async computeHMACSignatureAsync(e,t){let r=new TextEncoder,i=await this.subtleCrypto.importKey("raw",r.encode(t),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),s=new Uint8Array(await this.subtleCrypto.sign("hmac",i,r.encode(e))),n=Array(s.length);for(let e=0;e<s.length;e++)n[e]=U[s[e]];return n.join("")}async computeSHA256Async(e){return new Uint8Array(await this.subtleCrypto.digest("SHA-256",e))}}let U=Array(256);for(let e=0;e<U.length;e++)U[e]=e.toString(16).padStart(2,"0");class F{constructor(){this._fetchFn=null,this._agent=null}getUname(){throw Error("getUname not implemented.")}uuid4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}secureCompare(e,t){if(e.length!==t.length)return!1;let r=e.length,i=0;for(let s=0;s<r;++s)i|=e.charCodeAt(s)^t.charCodeAt(s);return 0===i}createEmitter(){throw Error("createEmitter not implemented.")}tryBufferData(e){throw Error("tryBufferData not implemented.")}createNodeHttpClient(e){throw Error("createNodeHttpClient not implemented.")}createFetchHttpClient(e){return new N(e)}createDefaultHttpClient(){throw Error("createDefaultHttpClient not implemented.")}createNodeCryptoProvider(){throw Error("createNodeCryptoProvider not implemented.")}createSubtleCryptoProvider(e){return new $(e)}createDefaultCryptoProvider(){throw Error("createDefaultCryptoProvider not implemented.")}}let L=e=>{switch(e.type){case"card_error":return new z(e);case"invalid_request_error":return new B(e);case"api_error":return new K(e);case"authentication_error":return new V(e);case"rate_limit_error":return new Q(e);case"idempotency_error":return new Z(e);case"invalid_grant":return new ee(e);default:return new et(e)}},H=e=>"temporary_session_expired"===e.type?new er(e):"invalid_fields"===e.code?new B(e):L(e);class W extends Error{constructor(e={},t=null){var r;super(e.message),this.type=t||this.constructor.name,this.raw=e,this.rawType=e.type,this.code=e.code,this.doc_url=e.doc_url,this.param=e.param,this.detail=e.detail,this.headers=e.headers,this.requestId=e.requestId,this.statusCode=e.statusCode,this.message=null!==(r=e.message)&&void 0!==r?r:"",this.userMessage=e.user_message,this.charge=e.charge,this.decline_code=e.decline_code,this.payment_intent=e.payment_intent,this.payment_method=e.payment_method,this.payment_method_type=e.payment_method_type,this.setup_intent=e.setup_intent,this.source=e.source}}W.generate=L;class z extends W{constructor(e={}){super(e,"StripeCardError")}}class B extends W{constructor(e={}){super(e,"StripeInvalidRequestError")}}class K extends W{constructor(e={}){super(e,"StripeAPIError")}}class V extends W{constructor(e={}){super(e,"StripeAuthenticationError")}}class J extends W{constructor(e={}){super(e,"StripePermissionError")}}class Q extends W{constructor(e={}){super(e,"StripeRateLimitError")}}class X extends W{constructor(e={}){super(e,"StripeConnectionError")}}class Y extends W{constructor(e,t,r={}){super(r,"StripeSignatureVerificationError"),this.header=e,this.payload=t}}class Z extends W{constructor(e={}){super(e,"StripeIdempotencyError")}}class ee extends W{constructor(e={}){super(e,"StripeInvalidGrantError")}}class et extends W{constructor(e={}){super(e,"StripeUnknownError")}}class er extends W{constructor(e={}){super(e,"TemporarySessionExpiredError")}}var ei=r(61282);class es extends W{}class en extends F{constructor(){super(),this._exec=ei.exec,this._UNAME_CACHE=null}uuid4(){return n.randomUUID?n.randomUUID():super.uuid4()}getUname(){return this._UNAME_CACHE||(this._UNAME_CACHE=new Promise((e,t)=>{try{this._exec("uname -a",(t,r)=>{if(t)return e(null);e(r)})}catch(t){e(null)}})),this._UNAME_CACHE}secureCompare(e,t){if(!e||!t)throw Error("secureCompare must receive two arguments");if(e.length!==t.length)return!1;if(n.timingSafeEqual){let r=new TextEncoder,i=r.encode(e),s=r.encode(t);return n.timingSafeEqual(i,s)}return super.secureCompare(e,t)}createEmitter(){return new o.EventEmitter}tryBufferData(e){if(!(e.file.data instanceof o.EventEmitter))return Promise.resolve(e);let t=[];return new Promise((r,i)=>{e.file.data.on("data",e=>{t.push(e)}).once("end",()=>{let i=Object.assign({},e);i.file.data=function(e){let t=new Uint8Array(e.reduce((e,t)=>e+t.length,0)),r=0;return e.forEach(e=>{t.set(e,r),r+=e.length}),t}(t),r(i)}).on("error",e=>{i(new es({message:"An error occurred while attempting to process the file for upload.",detail:e}))})})}createNodeHttpClient(e){return new P(e)}createDefaultHttpClient(){return new P}createNodeCryptoProvider(){return new c}createDefaultCryptoProvider(){return this.createNodeCryptoProvider()}}class eo{constructor(e,t){this._stripe=e,this._maxBufferedRequestMetric=t}_addHeadersDirectlyToObject(e,t){e.requestId=t["request-id"],e.stripeAccount=e.stripeAccount||t["stripe-account"],e.apiVersion=e.apiVersion||t["stripe-version"],e.idempotencyKey=e.idempotencyKey||t["idempotency-key"]}_makeResponseEvent(e,t,r){let i=Date.now(),s=i-e.request_start_time;return k({api_version:r["stripe-version"],account:r["stripe-account"],idempotency_key:r["idempotency-key"],method:e.method,path:e.path,status:t,request_id:this._getRequestId(r),elapsed:s,request_start_time:e.request_start_time,request_end_time:i})}_getRequestId(e){return e["request-id"]}_streamingResponseHandler(e,t,r){return i=>{let s=i.getHeaders(),n=i.toStream(()=>{let r=this._makeResponseEvent(e,i.getStatusCode(),s);this._stripe._emitter.emit("response",r),this._recordRequestMetrics(this._getRequestId(s),r.elapsed,t)});return this._addHeadersDirectlyToObject(n,s),r(null,n)}}_jsonResponseHandler(e,t,r,i){return s=>{let n=s.getHeaders(),o=this._getRequestId(n),a=s.getStatusCode(),l=this._makeResponseEvent(e,a,n);this._stripe._emitter.emit("response",l),s.toJSON().then(e=>{if(e.error)throw"string"==typeof e.error&&(e.error={type:e.error,message:e.error_description}),e.error.headers=n,e.error.statusCode=a,e.error.requestId=o,401===a?new V(e.error):403===a?new J(e.error):429===a?new Q(e.error):"v2"===t?H(e.error):L(e.error);return e},e=>{throw new K({message:"Invalid JSON received from the Stripe API",exception:e,requestId:n["request-id"]})}).then(e=>{this._recordRequestMetrics(o,l.elapsed,r);let t=s.getRawResponse();this._addHeadersDirectlyToObject(t,n),Object.defineProperty(e,"lastResponse",{enumerable:!1,writable:!1,value:t}),i(null,e)},e=>i(e,null))}}static _generateConnectionErrorMessage(e){return`An error occurred with our connection to Stripe.${e>0?` Request was retried ${e} times.`:""}`}static _shouldRetry(e,t,r,i){return!!(i&&0===t&&m.CONNECTION_CLOSED_ERROR_CODES.includes(i.code))||!(t>=r)&&(!e||"false"!==e.getHeaders()["stripe-should-retry"]&&!!("true"===e.getHeaders()["stripe-should-retry"]||409===e.getStatusCode()||e.getStatusCode()>=500))}_getSleepTimeInMS(e,t=null){let r=this._stripe.getInitialNetworkRetryDelay(),i=Math.min(r*Math.pow(2,e-1),this._stripe.getMaxNetworkRetryDelay());return i*=.5*(1+Math.random()),i=Math.max(r,i),Number.isInteger(t)&&t<=60&&(i=Math.max(i,t)),1e3*i}_getMaxNetworkRetries(e={}){return void 0!==e.maxNetworkRetries&&Number.isInteger(e.maxNetworkRetries)?e.maxNetworkRetries:this._stripe.getMaxNetworkRetries()}_defaultIdempotencyKey(e,t,r){let i=this._getMaxNetworkRetries(t),s=()=>`stripe-node-retry-${this._stripe._platformFunctions.uuid4()}`;if("v2"===r){if("POST"===e||"DELETE"===e)return s()}else if("v1"===r&&"POST"===e&&i>0)return s();return null}_makeHeaders({contentType:e,contentLength:t,apiVersion:r,clientUserAgent:i,method:s,userSuppliedHeaders:n,userSuppliedSettings:o,stripeAccount:a,stripeContext:l,apiMode:c}){let u={Accept:"application/json","Content-Type":e,"User-Agent":this._getUserAgentString(c),"X-Stripe-Client-User-Agent":i,"X-Stripe-Client-Telemetry":this._getTelemetryHeader(),"Stripe-Version":r,"Stripe-Account":a,"Stripe-Context":l,"Idempotency-Key":this._defaultIdempotencyKey(s,o,c)},d="POST"==s||"PUT"==s||"PATCH"==s;return(d||t)&&(d||R(`${s} method had non-zero contentLength but no payload is expected for this verb`),u["Content-Length"]=t),Object.assign(k(u),n&&"object"==typeof n?Object.keys(n).reduce((e,t)=>(e[t.split("-").map(e=>e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()).join("-")]=n[t],e),{}):n)}_getUserAgentString(e){let t=this._stripe.getConstant("PACKAGE_VERSION"),r=this._stripe._appInfo?this._stripe.getAppInfoAsString():"";return`Stripe/${e} NodeBindings/${t} ${r}`.trim()}_getTelemetryHeader(){if(this._stripe.getTelemetryEnabled()&&this._stripe._prevRequestMetrics.length>0)return JSON.stringify({last_request_metrics:this._stripe._prevRequestMetrics.shift()})}_recordRequestMetrics(e,t,r){if(this._stripe.getTelemetryEnabled()&&e){if(this._stripe._prevRequestMetrics.length>this._maxBufferedRequestMetric)R("Request metrics buffer is full, dropping telemetry message.");else{let i={request_id:e,request_duration_ms:t};r&&r.length>0&&(i.usage=r),this._stripe._prevRequestMetrics.push(i)}}}_rawRequest(e,t,r,i){return new Promise((s,n)=>{let o;try{let s=e.toUpperCase();if("POST"!==s&&r&&0!==Object.keys(r).length)throw Error("rawRequest only supports params on POST requests. Please pass null and add your parameters to path.");let n=[].slice.call([r,i]),a=O(n),l="POST"===s?Object.assign({},a):null,c=A(n),u=c.headers,d=c.authenticator;o={requestMethod:s,requestPath:t,bodyData:l,queryData:{},authenticator:d,headers:u,host:c.host,streaming:!!c.streaming,settings:{},usage:["raw_request"]}}catch(e){n(e);return}let{headers:a,settings:l}=o,c=o.authenticator;this._request(o.requestMethod,o.host,t,o.bodyData,c,{headers:a,settings:l,streaming:o.streaming},o.usage,function(e,t){e?n(e):s(t)})})}_request(e,t,r,i,s,n,o=[],a,l=null){var c;let u;s=null!==(c=null!=s?s:this._stripe._authenticator)&&void 0!==c?c:null;let d=M(r),h=(e,t,r,i,s)=>setTimeout(e,this._getSleepTimeInMS(i,s),t,r,i+1),p=(i,l,c)=>{let f=n.settings&&n.settings.timeout&&Number.isInteger(n.settings.timeout)&&n.settings.timeout>=0?n.settings.timeout:this._stripe.getApiField("timeout"),y={host:t||this._stripe.getApiField("host"),port:this._stripe.getApiField("port"),path:r,method:e,headers:Object.assign({},l),body:u,protocol:this._stripe.getApiField("protocol")};s(y).then(()=>{let t=this._stripe.getApiField("httpClient").makeRequest(y.host,y.port,y.path,y.method,y.headers,y.body,y.protocol,f),s=Date.now(),u=k({api_version:i,account:D(l["Stripe-Account"]),idempotency_key:D(l["Idempotency-Key"]),method:e,path:r,request_start_time:s}),g=c||0,v=this._getMaxNetworkRetries(n.settings||{});this._stripe._emitter.emit("request",u),t.then(e=>{if(eo._shouldRetry(e,g,v)){var t;return h(p,i,l,g,Number(Array.isArray(t=e.getHeaders()["retry-after"])?t[0]:t))}return n.streaming&&400>e.getStatusCode()?this._streamingResponseHandler(u,o,a)(e):this._jsonResponseHandler(u,d,o,a)(e)}).catch(e=>eo._shouldRetry(null,g,v,e)?h(p,i,l,g,null):a(new X({message:e.code&&e.code===m.TIMEOUT_ERROR_CODE?`Request aborted due to timeout being reached (${f}ms)`:eo._generateConnectionErrorMessage(g),detail:e})))}).catch(e=>{throw new W({message:"Unable to authenticate the request",exception:e})})},f=(t,r)=>{if(t)return a(t);u=r,this._stripe.getClientUserAgent(t=>{let r=this._stripe.getApiField("version"),i=this._makeHeaders({contentType:"v2"==d?"application/json":"application/x-www-form-urlencoded",contentLength:u.length,apiVersion:r,clientUserAgent:t,method:e,userSuppliedHeaders:n.headers,userSuppliedSettings:n.settings,stripeAccount:"v2"==d?null:this._stripe.getApiField("stripeAccount"),stripeContext:"v2"==d?this._stripe.getApiField("stripeContext"):null,apiMode:d});p(r,i,0)})};if(l)l(e,i,n.headers,f);else{let e;f(null,"v2"==d?i?JSON.stringify(i,G):"":w(i||{},d))}}}class ea{constructor(e,t,r,i){this.index=0,this.pagePromise=e,this.promiseCache={currentPromise:null},this.requestArgs=t,this.spec=r,this.stripeResource=i}async iterate(e){if(!(e&&e.data&&"number"==typeof e.data.length))throw Error("Unexpected: Stripe API response does not have a well-formed `data` array.");let t=ep(this.requestArgs);if(this.index<e.data.length){let r=t?e.data.length-1-this.index:this.index,i=e.data[r];return this.index+=1,{value:i,done:!1}}if(e.has_more){this.index=0,this.pagePromise=this.getNextPage(e);let t=await this.pagePromise;return this.iterate(t)}return{done:!0,value:void 0}}getNextPage(e){throw Error("Unimplemented")}async _next(){return this.iterate(await this.pagePromise)}next(){if(this.promiseCache.currentPromise)return this.promiseCache.currentPromise;let e=(async()=>{let e=await this._next();return this.promiseCache.currentPromise=null,e})();return this.promiseCache.currentPromise=e,e}}class el extends ea{getNextPage(e){let t=ep(this.requestArgs),r=function(e,t){let r=t?0:e.data.length-1,i=e.data[r],s=i&&i.id;if(!s)throw Error("Unexpected: No `id` found on the last item while auto-paging a list.");return s}(e,t);return this.stripeResource._makeRequest(this.requestArgs,this.spec,{[t?"ending_before":"starting_after"]:r})}}class ec extends ea{getNextPage(e){if(!e.next_page)throw Error("Unexpected: Stripe API response does not have a well-formed `next_page` field, but `has_more` was true.");return this.stripeResource._makeRequest(this.requestArgs,this.spec,{page:e.next_page})}}class eu{constructor(e,t,r,i){this.currentPageIterator=(async()=>(await e).data[Symbol.iterator]())(),this.nextPageUrl=(async()=>(await e).next_page_url||null)(),this.requestArgs=t,this.spec=r,this.stripeResource=i}async turnPage(){let e=await this.nextPageUrl;if(!e)return null;this.spec.fullPath=e;let t=await this.stripeResource._makeRequest([],this.spec,{});return this.nextPageUrl=Promise.resolve(t.next_page_url),this.currentPageIterator=Promise.resolve(t.data[Symbol.iterator]()),this.currentPageIterator}async next(){{let e=(await this.currentPageIterator).next();if(!e.done)return{done:!1,value:e.value}}let e=await this.turnPage();if(!e)return{done:!0,value:void 0};let t=e.next();return t.done?{done:!0,value:void 0}:{done:!1,value:t.value}}}let ed=(e,t,r,i)=>{let s=M(r.fullPath||r.path);return"v2"!==s&&"search"===r.methodType?eh(new ec(i,t,r,e)):"v2"!==s&&"list"===r.methodType?eh(new el(i,t,r,e)):"v2"===s&&"list"===r.methodType?eh(new eu(i,t,r,e)):null},eh=e=>{var t;let r=(t=(...t)=>e.next(...t),function(){let e=[].slice.call(arguments),r=function(e){if(0===e.length)return;let t=e[0];if("function"!=typeof t)throw Error(`The first argument to autoPagingEach, if present, must be a callback function; received ${typeof t}`);if(2===t.length)return t;if(t.length>2)throw Error(`The \`onItem\` callback function passed to autoPagingEach must accept at most two arguments; got ${t}`);return function(e,r){r(t(e))}}(e),i=function(e){if(e.length<2)return null;let t=e[1];if("function"!=typeof t)throw Error(`The second argument to autoPagingEach, if present, must be a callback function; received ${typeof t}`);return t}(e);if(e.length>2)throw Error(`autoPagingEach takes up to two arguments; received ${e}`);return C(new Promise((e,i)=>{t().then(function i(s){if(s.done){e();return}let n=s.value;return new Promise(e=>{r(n,e)}).then(e=>!1===e?i({done:!0,value:void 0}):t().then(i))}).catch(i)}),i)}),i={autoPagingEach:r,autoPagingToArray:function(e,t){let i=e&&e.limit;if(!i)throw Error("You must pass a `limit` option to autoPagingToArray, e.g., `autoPagingToArray({limit: 1000});`.");if(i>1e4)throw Error("You cannot specify a limit of more than 10,000 items to fetch in `autoPagingToArray`; use `autoPagingEach` to iterate through longer lists.");return C(new Promise((e,t)=>{let s=[];r(e=>{if(s.push(e),s.length>=i)return!1}).then(()=>{e(s)}).catch(t)}),t)},next:()=>e.next(),return:()=>({}),["undefined"!=typeof Symbol&&Symbol.asyncIterator?Symbol.asyncIterator:"@@asyncIterator"]:()=>i};return i};function ep(e){return!!O([].slice.call(e)).ending_before}function em(e,t){if(this._stripe=e,t)throw Error("Support for curried url params was dropped in stripe-node v7.0.0. Instead, pass two ids.");this.basePath=x(this.basePath||e.getApiField("basePath")),this.resourcePath=this.path,this.path=x(this.path),this.initialize(...arguments)}function ef(e,t){for(let r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;let i=r[0].toLowerCase()+r.substring(1),s=new t[r](e);this[i]=s}}function ey(e,t){return function(e){return new ef(e,t)}}em.extend=function(e){let t=this,r=Object.prototype.hasOwnProperty.call(e,"constructor")?e.constructor:function(...e){t.apply(this,e)};return Object.assign(r,t),r.prototype=Object.create(t.prototype),Object.assign(r.prototype,e),r},em.method=function(e){if(void 0!==e.path&&void 0!==e.fullPath)throw Error(`Method spec specified both a 'path' (${e.path}) and a 'fullPath' (${e.fullPath}).`);return function(...t){let r="function"==typeof t[t.length-1]&&t.pop();e.urlParams=function(e){let t=e.match(/\{\w+\}/g);return t?t.map(e=>e.replace(/[{}]/g,"")):[]}(e.fullPath||this.createResourcePathWithSymbols(e.path||""));let i=C(this._makeRequest(t,e,{}),r);return Object.assign(i,ed(this,t,e,i)),i}},em.MAX_BUFFERED_REQUEST_METRICS=100,em.prototype={_stripe:null,path:"",resourcePath:"",basePath:null,initialize(){},requestDataProcessor:null,validateRequest:null,createFullPath(e,t){let r=[this.basePath(t),this.path(t)];if("function"==typeof e){let i=e(t);i&&r.push(i)}else r.push(e);return this._joinUrlParts(r)},createResourcePathWithSymbols(e){return e?`/${this._joinUrlParts([this.resourcePath,e])}`:`/${this.resourcePath}`},_joinUrlParts:e=>e.join("/").replace(/\/{2,}/g,"/"),_getRequestOpts(e,t,r){var i;let s=(t.method||"GET").toUpperCase(),n=t.usage||[],o=t.urlParams||[],a=t.encode||(e=>e),l=!!t.fullPath,c=x(l?t.fullPath:t.path||""),u=l?t.fullPath:this.createResourcePathWithSymbols(t.path),d=[].slice.call(e),h=o.reduce((e,t)=>{let r=d.shift();if("string"!=typeof r)throw Error(`Stripe: Argument "${t}" must be a string, but got: ${r} (on API request to \`${s} ${u}\`)`);return e[t]=r,e},{}),p=a(Object.assign({},O(d),r)),m=A(d),f=m.host||t.host,y=!!t.streaming||!!m.streaming;if(d.filter(e=>null!=e).length)throw Error(`Stripe: Unknown arguments (${d}). Did you mean to pass an options object? See https://github.com/stripe/stripe-node/wiki/Passing-Options. (on API request to ${s} \`${u}\`)`);let g=l?c(h):this.createFullPath(c,h),v=Object.assign(m.headers,t.headers);t.validator&&t.validator(p,{headers:v});let _="GET"===t.method||"DELETE"===t.method;return{requestMethod:s,requestPath:g,bodyData:_?null:p,queryData:_?p:{},authenticator:null!==(i=m.authenticator)&&void 0!==i?i:null,headers:v,host:null!=f?f:null,streaming:y,settings:m.settings,usage:n}},_makeRequest(e,t,r){return new Promise((i,s)=>{var n;let o;try{o=this._getRequestOpts(e,t,r)}catch(e){s(e);return}let a=0===Object.keys(o.queryData).length,l=[o.requestPath,a?"":"?",w(o.queryData,M(o.requestPath))].join(""),{headers:c,settings:u}=o;this._stripe._requestSender._request(o.requestMethod,o.host,l,o.bodyData,o.authenticator,{headers:c,settings:u,streaming:o.streaming},o.usage,function(e,r){e?s(e):i(t.transformResponseData?t.transformResponseData(r):r)},null===(n=this.requestDataProcessor)||void 0===n?void 0:n.bind(this))})}};let eg=em.method,ev=em.extend({retrieve:eg({method:"GET",fullPath:"/v1/financial_connections/accounts/{account}"}),list:eg({method:"GET",fullPath:"/v1/financial_connections/accounts",methodType:"list"}),disconnect:eg({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/disconnect"}),listOwners:eg({method:"GET",fullPath:"/v1/financial_connections/accounts/{account}/owners",methodType:"list"}),refresh:eg({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/refresh"}),subscribe:eg({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/subscribe"}),unsubscribe:eg({method:"POST",fullPath:"/v1/financial_connections/accounts/{account}/unsubscribe"})}),e_=em.method,eP=em.extend({retrieve:e_({method:"GET",fullPath:"/v1/entitlements/active_entitlements/{id}"}),list:e_({method:"GET",fullPath:"/v1/entitlements/active_entitlements",methodType:"list"})}),eb=em.method,eT=em.extend({create:eb({method:"POST",fullPath:"/v1/billing/alerts"}),retrieve:eb({method:"GET",fullPath:"/v1/billing/alerts/{id}"}),list:eb({method:"GET",fullPath:"/v1/billing/alerts",methodType:"list"}),activate:eb({method:"POST",fullPath:"/v1/billing/alerts/{id}/activate"}),archive:eb({method:"POST",fullPath:"/v1/billing/alerts/{id}/archive"}),deactivate:eb({method:"POST",fullPath:"/v1/billing/alerts/{id}/deactivate"})}),eE=em.method,eS=em.extend({create:eE({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations"}),capture:eE({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/capture"}),expire:eE({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/expire"}),finalizeAmount:eE({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/finalize_amount"}),increment:eE({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/increment"}),respond:eE({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/fraud_challenges/respond"}),reverse:eE({method:"POST",fullPath:"/v1/test_helpers/issuing/authorizations/{authorization}/reverse"})}),ew=em.method,ex=em.extend({retrieve:ew({method:"GET",fullPath:"/v1/issuing/authorizations/{authorization}"}),update:ew({method:"POST",fullPath:"/v1/issuing/authorizations/{authorization}"}),list:ew({method:"GET",fullPath:"/v1/issuing/authorizations",methodType:"list"}),approve:ew({method:"POST",fullPath:"/v1/issuing/authorizations/{authorization}/approve"}),decline:ew({method:"POST",fullPath:"/v1/issuing/authorizations/{authorization}/decline"})}),eO=em.method,eA=em.extend({create:eO({method:"POST",fullPath:"/v1/tax/calculations"}),retrieve:eO({method:"GET",fullPath:"/v1/tax/calculations/{calculation}"}),listLineItems:eO({method:"GET",fullPath:"/v1/tax/calculations/{calculation}/line_items",methodType:"list"})}),ek=em.method,eC=em.extend({create:ek({method:"POST",fullPath:"/v1/issuing/cardholders"}),retrieve:ek({method:"GET",fullPath:"/v1/issuing/cardholders/{cardholder}"}),update:ek({method:"POST",fullPath:"/v1/issuing/cardholders/{cardholder}"}),list:ek({method:"GET",fullPath:"/v1/issuing/cardholders",methodType:"list"})}),eR=em.method,eI=em.extend({deliverCard:eR({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/deliver"}),failCard:eR({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/fail"}),returnCard:eR({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/return"}),shipCard:eR({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/ship"}),submitCard:eR({method:"POST",fullPath:"/v1/test_helpers/issuing/cards/{card}/shipping/submit"})}),ej=em.method,eG=em.extend({create:ej({method:"POST",fullPath:"/v1/issuing/cards"}),retrieve:ej({method:"GET",fullPath:"/v1/issuing/cards/{card}"}),update:ej({method:"POST",fullPath:"/v1/issuing/cards/{card}"}),list:ej({method:"GET",fullPath:"/v1/issuing/cards",methodType:"list"})}),eM=em.method,eD=em.extend({create:eM({method:"POST",fullPath:"/v1/billing_portal/configurations"}),retrieve:eM({method:"GET",fullPath:"/v1/billing_portal/configurations/{configuration}"}),update:eM({method:"POST",fullPath:"/v1/billing_portal/configurations/{configuration}"}),list:eM({method:"GET",fullPath:"/v1/billing_portal/configurations",methodType:"list"})}),eN=em.method,eq=em.extend({create:eN({method:"POST",fullPath:"/v1/terminal/configurations"}),retrieve:eN({method:"GET",fullPath:"/v1/terminal/configurations/{configuration}"}),update:eN({method:"POST",fullPath:"/v1/terminal/configurations/{configuration}"}),list:eN({method:"GET",fullPath:"/v1/terminal/configurations",methodType:"list"}),del:eN({method:"DELETE",fullPath:"/v1/terminal/configurations/{configuration}"})}),e$=em.method,eU=em.extend({create:e$({method:"POST",fullPath:"/v1/test_helpers/confirmation_tokens"})}),eF=em.method,eL=em.extend({create:eF({method:"POST",fullPath:"/v1/terminal/connection_tokens"})}),eH=em.method,eW=em.extend({retrieve:eH({method:"GET",fullPath:"/v1/billing/credit_balance_summary"})}),ez=em.method,eB=em.extend({retrieve:ez({method:"GET",fullPath:"/v1/billing/credit_balance_transactions/{id}"}),list:ez({method:"GET",fullPath:"/v1/billing/credit_balance_transactions",methodType:"list"})}),eK=em.method,eV=em.extend({create:eK({method:"POST",fullPath:"/v1/billing/credit_grants"}),retrieve:eK({method:"GET",fullPath:"/v1/billing/credit_grants/{id}"}),update:eK({method:"POST",fullPath:"/v1/billing/credit_grants/{id}"}),list:eK({method:"GET",fullPath:"/v1/billing/credit_grants",methodType:"list"}),expire:eK({method:"POST",fullPath:"/v1/billing/credit_grants/{id}/expire"}),voidGrant:eK({method:"POST",fullPath:"/v1/billing/credit_grants/{id}/void"})}),eJ=em.method,eQ=em.extend({create:eJ({method:"POST",fullPath:"/v1/treasury/credit_reversals"}),retrieve:eJ({method:"GET",fullPath:"/v1/treasury/credit_reversals/{credit_reversal}"}),list:eJ({method:"GET",fullPath:"/v1/treasury/credit_reversals",methodType:"list"})}),eX=em.method,eY=em.extend({fundCashBalance:eX({method:"POST",fullPath:"/v1/test_helpers/customers/{customer}/fund_cash_balance"})}),eZ=em.method,e1=em.extend({create:eZ({method:"POST",fullPath:"/v1/treasury/debit_reversals"}),retrieve:eZ({method:"GET",fullPath:"/v1/treasury/debit_reversals/{debit_reversal}"}),list:eZ({method:"GET",fullPath:"/v1/treasury/debit_reversals",methodType:"list"})}),e0=em.method,e2=em.extend({create:e0({method:"POST",fullPath:"/v1/issuing/disputes"}),retrieve:e0({method:"GET",fullPath:"/v1/issuing/disputes/{dispute}"}),update:e0({method:"POST",fullPath:"/v1/issuing/disputes/{dispute}"}),list:e0({method:"GET",fullPath:"/v1/issuing/disputes",methodType:"list"}),submit:e0({method:"POST",fullPath:"/v1/issuing/disputes/{dispute}/submit"})}),e6=em.method,e8=em.extend({retrieve:e6({method:"GET",fullPath:"/v1/radar/early_fraud_warnings/{early_fraud_warning}"}),list:e6({method:"GET",fullPath:"/v1/radar/early_fraud_warnings",methodType:"list"})}),e3=em.method,e5=em.extend({create:e3({method:"POST",fullPath:"/v2/core/event_destinations"}),retrieve:e3({method:"GET",fullPath:"/v2/core/event_destinations/{id}"}),update:e3({method:"POST",fullPath:"/v2/core/event_destinations/{id}"}),list:e3({method:"GET",fullPath:"/v2/core/event_destinations",methodType:"list"}),del:e3({method:"DELETE",fullPath:"/v2/core/event_destinations/{id}"}),disable:e3({method:"POST",fullPath:"/v2/core/event_destinations/{id}/disable"}),enable:e3({method:"POST",fullPath:"/v2/core/event_destinations/{id}/enable"}),ping:e3({method:"POST",fullPath:"/v2/core/event_destinations/{id}/ping"})}),e4=em.method,e9=em.extend({retrieve(...e){return e4({method:"GET",fullPath:"/v2/core/events/{id}",transformResponseData:e=>this.addFetchRelatedObjectIfNeeded(e)}).apply(this,e)},list(...e){return e4({method:"GET",fullPath:"/v2/core/events",methodType:"list",transformResponseData:e=>Object.assign(Object.assign({},e),{data:e.data.map(this.addFetchRelatedObjectIfNeeded.bind(this))})}).apply(this,e)},addFetchRelatedObjectIfNeeded(e){return e.related_object&&e.related_object.url?Object.assign(Object.assign({},e),{fetchRelatedObject:()=>e4({method:"GET",fullPath:e.related_object.url}).apply(this,[{stripeAccount:e.context}])}):e}}),e7=em.method,te=em.extend({create:e7({method:"POST",fullPath:"/v1/entitlements/features"}),retrieve:e7({method:"GET",fullPath:"/v1/entitlements/features/{id}"}),update:e7({method:"POST",fullPath:"/v1/entitlements/features/{id}"}),list:e7({method:"GET",fullPath:"/v1/entitlements/features",methodType:"list"})}),tt=em.method,tr=em.extend({create:tt({method:"POST",fullPath:"/v1/treasury/financial_accounts"}),retrieve:tt({method:"GET",fullPath:"/v1/treasury/financial_accounts/{financial_account}"}),update:tt({method:"POST",fullPath:"/v1/treasury/financial_accounts/{financial_account}"}),list:tt({method:"GET",fullPath:"/v1/treasury/financial_accounts",methodType:"list"}),close:tt({method:"POST",fullPath:"/v1/treasury/financial_accounts/{financial_account}/close"}),retrieveFeatures:tt({method:"GET",fullPath:"/v1/treasury/financial_accounts/{financial_account}/features"}),updateFeatures:tt({method:"POST",fullPath:"/v1/treasury/financial_accounts/{financial_account}/features"})}),ti=em.method,ts=em.extend({fail:ti({method:"POST",fullPath:"/v1/test_helpers/treasury/inbound_transfers/{id}/fail"}),returnInboundTransfer:ti({method:"POST",fullPath:"/v1/test_helpers/treasury/inbound_transfers/{id}/return"}),succeed:ti({method:"POST",fullPath:"/v1/test_helpers/treasury/inbound_transfers/{id}/succeed"})}),tn=em.method,to=em.extend({create:tn({method:"POST",fullPath:"/v1/treasury/inbound_transfers"}),retrieve:tn({method:"GET",fullPath:"/v1/treasury/inbound_transfers/{id}"}),list:tn({method:"GET",fullPath:"/v1/treasury/inbound_transfers",methodType:"list"}),cancel:tn({method:"POST",fullPath:"/v1/treasury/inbound_transfers/{inbound_transfer}/cancel"})}),ta=em.method,tl=em.extend({create:ta({method:"POST",fullPath:"/v1/terminal/locations"}),retrieve:ta({method:"GET",fullPath:"/v1/terminal/locations/{location}"}),update:ta({method:"POST",fullPath:"/v1/terminal/locations/{location}"}),list:ta({method:"GET",fullPath:"/v1/terminal/locations",methodType:"list"}),del:ta({method:"DELETE",fullPath:"/v1/terminal/locations/{location}"})}),tc=em.method,tu=em.extend({create:tc({method:"POST",fullPath:"/v1/billing/meter_event_adjustments"})}),td=em.method,th=em.extend({create:td({method:"POST",fullPath:"/v2/billing/meter_event_adjustments"})}),tp=em.method,tm=em.extend({create:tp({method:"POST",fullPath:"/v2/billing/meter_event_session"})}),tf=em.method,ty=em.extend({create:tf({method:"POST",fullPath:"/v2/billing/meter_event_stream",host:"meter-events.stripe.com"})}),tg=em.method,tv=em.extend({create:tg({method:"POST",fullPath:"/v1/billing/meter_events"})}),t_=em.method,tP=em.extend({create:t_({method:"POST",fullPath:"/v2/billing/meter_events"})}),tb=em.method,tT=em.extend({create:tb({method:"POST",fullPath:"/v1/billing/meters"}),retrieve:tb({method:"GET",fullPath:"/v1/billing/meters/{id}"}),update:tb({method:"POST",fullPath:"/v1/billing/meters/{id}"}),list:tb({method:"GET",fullPath:"/v1/billing/meters",methodType:"list"}),deactivate:tb({method:"POST",fullPath:"/v1/billing/meters/{id}/deactivate"}),listEventSummaries:tb({method:"GET",fullPath:"/v1/billing/meters/{id}/event_summaries",methodType:"list"}),reactivate:tb({method:"POST",fullPath:"/v1/billing/meters/{id}/reactivate"})}),tE=em.method,tS=em.extend({create:tE({method:"POST",fullPath:"/v1/climate/orders"}),retrieve:tE({method:"GET",fullPath:"/v1/climate/orders/{order}"}),update:tE({method:"POST",fullPath:"/v1/climate/orders/{order}"}),list:tE({method:"GET",fullPath:"/v1/climate/orders",methodType:"list"}),cancel:tE({method:"POST",fullPath:"/v1/climate/orders/{order}/cancel"})}),tw=em.method,tx=em.extend({update:tw({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}"}),fail:tw({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}/fail"}),post:tw({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}/post"}),returnOutboundPayment:tw({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_payments/{id}/return"})}),tO=em.method,tA=em.extend({create:tO({method:"POST",fullPath:"/v1/treasury/outbound_payments"}),retrieve:tO({method:"GET",fullPath:"/v1/treasury/outbound_payments/{id}"}),list:tO({method:"GET",fullPath:"/v1/treasury/outbound_payments",methodType:"list"}),cancel:tO({method:"POST",fullPath:"/v1/treasury/outbound_payments/{id}/cancel"})}),tk=em.method,tC=em.extend({update:tk({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}"}),fail:tk({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}/fail"}),post:tk({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}/post"}),returnOutboundTransfer:tk({method:"POST",fullPath:"/v1/test_helpers/treasury/outbound_transfers/{outbound_transfer}/return"})}),tR=em.method,tI=em.extend({create:tR({method:"POST",fullPath:"/v1/treasury/outbound_transfers"}),retrieve:tR({method:"GET",fullPath:"/v1/treasury/outbound_transfers/{outbound_transfer}"}),list:tR({method:"GET",fullPath:"/v1/treasury/outbound_transfers",methodType:"list"}),cancel:tR({method:"POST",fullPath:"/v1/treasury/outbound_transfers/{outbound_transfer}/cancel"})}),tj=em.method,tG=em.extend({activate:tj({method:"POST",fullPath:"/v1/test_helpers/issuing/personalization_designs/{personalization_design}/activate"}),deactivate:tj({method:"POST",fullPath:"/v1/test_helpers/issuing/personalization_designs/{personalization_design}/deactivate"}),reject:tj({method:"POST",fullPath:"/v1/test_helpers/issuing/personalization_designs/{personalization_design}/reject"})}),tM=em.method,tD=em.extend({create:tM({method:"POST",fullPath:"/v1/issuing/personalization_designs"}),retrieve:tM({method:"GET",fullPath:"/v1/issuing/personalization_designs/{personalization_design}"}),update:tM({method:"POST",fullPath:"/v1/issuing/personalization_designs/{personalization_design}"}),list:tM({method:"GET",fullPath:"/v1/issuing/personalization_designs",methodType:"list"})}),tN=em.method,tq=em.extend({retrieve:tN({method:"GET",fullPath:"/v1/issuing/physical_bundles/{physical_bundle}"}),list:tN({method:"GET",fullPath:"/v1/issuing/physical_bundles",methodType:"list"})}),t$=em.method,tU=em.extend({retrieve:t$({method:"GET",fullPath:"/v1/climate/products/{product}"}),list:t$({method:"GET",fullPath:"/v1/climate/products",methodType:"list"})}),tF=em.method,tL=em.extend({presentPaymentMethod:tF({method:"POST",fullPath:"/v1/test_helpers/terminal/readers/{reader}/present_payment_method"}),succeedInputCollection:tF({method:"POST",fullPath:"/v1/test_helpers/terminal/readers/{reader}/succeed_input_collection"}),timeoutInputCollection:tF({method:"POST",fullPath:"/v1/test_helpers/terminal/readers/{reader}/timeout_input_collection"})}),tH=em.method,tW=em.extend({create:tH({method:"POST",fullPath:"/v1/terminal/readers"}),retrieve:tH({method:"GET",fullPath:"/v1/terminal/readers/{reader}"}),update:tH({method:"POST",fullPath:"/v1/terminal/readers/{reader}"}),list:tH({method:"GET",fullPath:"/v1/terminal/readers",methodType:"list"}),del:tH({method:"DELETE",fullPath:"/v1/terminal/readers/{reader}"}),cancelAction:tH({method:"POST",fullPath:"/v1/terminal/readers/{reader}/cancel_action"}),collectInputs:tH({method:"POST",fullPath:"/v1/terminal/readers/{reader}/collect_inputs"}),collectPaymentMethod:tH({method:"POST",fullPath:"/v1/terminal/readers/{reader}/collect_payment_method"}),confirmPaymentIntent:tH({method:"POST",fullPath:"/v1/terminal/readers/{reader}/confirm_payment_intent"}),processPaymentIntent:tH({method:"POST",fullPath:"/v1/terminal/readers/{reader}/process_payment_intent"}),processSetupIntent:tH({method:"POST",fullPath:"/v1/terminal/readers/{reader}/process_setup_intent"}),refundPayment:tH({method:"POST",fullPath:"/v1/terminal/readers/{reader}/refund_payment"}),setReaderDisplay:tH({method:"POST",fullPath:"/v1/terminal/readers/{reader}/set_reader_display"})}),tz=em.method,tB=em.extend({create:tz({method:"POST",fullPath:"/v1/test_helpers/treasury/received_credits"})}),tK=em.method,tV=em.extend({retrieve:tK({method:"GET",fullPath:"/v1/treasury/received_credits/{id}"}),list:tK({method:"GET",fullPath:"/v1/treasury/received_credits",methodType:"list"})}),tJ=em.method,tQ=em.extend({create:tJ({method:"POST",fullPath:"/v1/test_helpers/treasury/received_debits"})}),tX=em.method,tY=em.extend({retrieve:tX({method:"GET",fullPath:"/v1/treasury/received_debits/{id}"}),list:tX({method:"GET",fullPath:"/v1/treasury/received_debits",methodType:"list"})}),tZ=em.method,t1=em.extend({expire:tZ({method:"POST",fullPath:"/v1/test_helpers/refunds/{refund}/expire"})}),t0=em.method,t2=em.extend({create:t0({method:"POST",fullPath:"/v1/tax/registrations"}),retrieve:t0({method:"GET",fullPath:"/v1/tax/registrations/{id}"}),update:t0({method:"POST",fullPath:"/v1/tax/registrations/{id}"}),list:t0({method:"GET",fullPath:"/v1/tax/registrations",methodType:"list"})}),t6=em.method,t8=em.extend({create:t6({method:"POST",fullPath:"/v1/reporting/report_runs"}),retrieve:t6({method:"GET",fullPath:"/v1/reporting/report_runs/{report_run}"}),list:t6({method:"GET",fullPath:"/v1/reporting/report_runs",methodType:"list"})}),t3=em.method,t5=em.extend({retrieve:t3({method:"GET",fullPath:"/v1/reporting/report_types/{report_type}"}),list:t3({method:"GET",fullPath:"/v1/reporting/report_types",methodType:"list"})}),t4=em.method,t9=em.extend({create:t4({method:"POST",fullPath:"/v1/forwarding/requests"}),retrieve:t4({method:"GET",fullPath:"/v1/forwarding/requests/{id}"}),list:t4({method:"GET",fullPath:"/v1/forwarding/requests",methodType:"list"})}),t7=em.method,re=em.extend({retrieve:t7({method:"GET",fullPath:"/v1/sigma/scheduled_query_runs/{scheduled_query_run}"}),list:t7({method:"GET",fullPath:"/v1/sigma/scheduled_query_runs",methodType:"list"})}),rt=em.method,rr=em.extend({create:rt({method:"POST",fullPath:"/v1/apps/secrets"}),list:rt({method:"GET",fullPath:"/v1/apps/secrets",methodType:"list"}),deleteWhere:rt({method:"POST",fullPath:"/v1/apps/secrets/delete"}),find:rt({method:"GET",fullPath:"/v1/apps/secrets/find"})}),ri=em.method,rs=em.extend({create:ri({method:"POST",fullPath:"/v1/billing_portal/sessions"})}),rn=em.method,ro=em.extend({create:rn({method:"POST",fullPath:"/v1/checkout/sessions"}),retrieve:rn({method:"GET",fullPath:"/v1/checkout/sessions/{session}"}),update:rn({method:"POST",fullPath:"/v1/checkout/sessions/{session}"}),list:rn({method:"GET",fullPath:"/v1/checkout/sessions",methodType:"list"}),expire:rn({method:"POST",fullPath:"/v1/checkout/sessions/{session}/expire"}),listLineItems:rn({method:"GET",fullPath:"/v1/checkout/sessions/{session}/line_items",methodType:"list"})}),ra=em.method,rl=em.extend({create:ra({method:"POST",fullPath:"/v1/financial_connections/sessions"}),retrieve:ra({method:"GET",fullPath:"/v1/financial_connections/sessions/{session}"})}),rc=em.method,ru=em.extend({retrieve:rc({method:"GET",fullPath:"/v1/tax/settings"}),update:rc({method:"POST",fullPath:"/v1/tax/settings"})}),rd=em.method,rh=em.extend({retrieve:rd({method:"GET",fullPath:"/v1/climate/suppliers/{supplier}"}),list:rd({method:"GET",fullPath:"/v1/climate/suppliers",methodType:"list"})}),rp=em.method,rm=em.extend({create:rp({method:"POST",fullPath:"/v1/test_helpers/test_clocks"}),retrieve:rp({method:"GET",fullPath:"/v1/test_helpers/test_clocks/{test_clock}"}),list:rp({method:"GET",fullPath:"/v1/test_helpers/test_clocks",methodType:"list"}),del:rp({method:"DELETE",fullPath:"/v1/test_helpers/test_clocks/{test_clock}"}),advance:rp({method:"POST",fullPath:"/v1/test_helpers/test_clocks/{test_clock}/advance"})}),rf=em.method,ry=em.extend({retrieve:rf({method:"GET",fullPath:"/v1/issuing/tokens/{token}"}),update:rf({method:"POST",fullPath:"/v1/issuing/tokens/{token}"}),list:rf({method:"GET",fullPath:"/v1/issuing/tokens",methodType:"list"})}),rg=em.method,rv=em.extend({retrieve:rg({method:"GET",fullPath:"/v1/treasury/transaction_entries/{id}"}),list:rg({method:"GET",fullPath:"/v1/treasury/transaction_entries",methodType:"list"})}),r_=em.method,rP=em.extend({createForceCapture:r_({method:"POST",fullPath:"/v1/test_helpers/issuing/transactions/create_force_capture"}),createUnlinkedRefund:r_({method:"POST",fullPath:"/v1/test_helpers/issuing/transactions/create_unlinked_refund"}),refund:r_({method:"POST",fullPath:"/v1/test_helpers/issuing/transactions/{transaction}/refund"})}),rb=em.method,rT=em.extend({retrieve:rb({method:"GET",fullPath:"/v1/financial_connections/transactions/{transaction}"}),list:rb({method:"GET",fullPath:"/v1/financial_connections/transactions",methodType:"list"})}),rE=em.method,rS=em.extend({retrieve:rE({method:"GET",fullPath:"/v1/issuing/transactions/{transaction}"}),update:rE({method:"POST",fullPath:"/v1/issuing/transactions/{transaction}"}),list:rE({method:"GET",fullPath:"/v1/issuing/transactions",methodType:"list"})}),rw=em.method,rx=em.extend({retrieve:rw({method:"GET",fullPath:"/v1/tax/transactions/{transaction}"}),createFromCalculation:rw({method:"POST",fullPath:"/v1/tax/transactions/create_from_calculation"}),createReversal:rw({method:"POST",fullPath:"/v1/tax/transactions/create_reversal"}),listLineItems:rw({method:"GET",fullPath:"/v1/tax/transactions/{transaction}/line_items",methodType:"list"})}),rO=em.method,rA=em.extend({retrieve:rO({method:"GET",fullPath:"/v1/treasury/transactions/{id}"}),list:rO({method:"GET",fullPath:"/v1/treasury/transactions",methodType:"list"})}),rk=em.method,rC=em.extend({create:rk({method:"POST",fullPath:"/v1/radar/value_list_items"}),retrieve:rk({method:"GET",fullPath:"/v1/radar/value_list_items/{item}"}),list:rk({method:"GET",fullPath:"/v1/radar/value_list_items",methodType:"list"}),del:rk({method:"DELETE",fullPath:"/v1/radar/value_list_items/{item}"})}),rR=em.method,rI=em.extend({create:rR({method:"POST",fullPath:"/v1/radar/value_lists"}),retrieve:rR({method:"GET",fullPath:"/v1/radar/value_lists/{value_list}"}),update:rR({method:"POST",fullPath:"/v1/radar/value_lists/{value_list}"}),list:rR({method:"GET",fullPath:"/v1/radar/value_lists",methodType:"list"}),del:rR({method:"DELETE",fullPath:"/v1/radar/value_lists/{value_list}"})}),rj=em.method,rG=em.extend({retrieve:rj({method:"GET",fullPath:"/v1/identity/verification_reports/{report}"}),list:rj({method:"GET",fullPath:"/v1/identity/verification_reports",methodType:"list"})}),rM=em.method,rD=em.extend({create:rM({method:"POST",fullPath:"/v1/identity/verification_sessions"}),retrieve:rM({method:"GET",fullPath:"/v1/identity/verification_sessions/{session}"}),update:rM({method:"POST",fullPath:"/v1/identity/verification_sessions/{session}"}),list:rM({method:"GET",fullPath:"/v1/identity/verification_sessions",methodType:"list"}),cancel:rM({method:"POST",fullPath:"/v1/identity/verification_sessions/{session}/cancel"}),redact:rM({method:"POST",fullPath:"/v1/identity/verification_sessions/{session}/redact"})}),rN=em.method,rq=em.extend({create:rN({method:"POST",fullPath:"/v1/accounts"}),retrieve(e,...t){return"string"==typeof e?rN({method:"GET",fullPath:"/v1/accounts/{id}"}).apply(this,[e,...t]):(null==e&&[].shift.apply([e,...t]),rN({method:"GET",fullPath:"/v1/account"}).apply(this,[e,...t]))},update:rN({method:"POST",fullPath:"/v1/accounts/{account}"}),list:rN({method:"GET",fullPath:"/v1/accounts",methodType:"list"}),del:rN({method:"DELETE",fullPath:"/v1/accounts/{account}"}),createExternalAccount:rN({method:"POST",fullPath:"/v1/accounts/{account}/external_accounts"}),createLoginLink:rN({method:"POST",fullPath:"/v1/accounts/{account}/login_links"}),createPerson:rN({method:"POST",fullPath:"/v1/accounts/{account}/persons"}),deleteExternalAccount:rN({method:"DELETE",fullPath:"/v1/accounts/{account}/external_accounts/{id}"}),deletePerson:rN({method:"DELETE",fullPath:"/v1/accounts/{account}/persons/{person}"}),listCapabilities:rN({method:"GET",fullPath:"/v1/accounts/{account}/capabilities",methodType:"list"}),listExternalAccounts:rN({method:"GET",fullPath:"/v1/accounts/{account}/external_accounts",methodType:"list"}),listPersons:rN({method:"GET",fullPath:"/v1/accounts/{account}/persons",methodType:"list"}),reject:rN({method:"POST",fullPath:"/v1/accounts/{account}/reject"}),retrieveCurrent:rN({method:"GET",fullPath:"/v1/account"}),retrieveCapability:rN({method:"GET",fullPath:"/v1/accounts/{account}/capabilities/{capability}"}),retrieveExternalAccount:rN({method:"GET",fullPath:"/v1/accounts/{account}/external_accounts/{id}"}),retrievePerson:rN({method:"GET",fullPath:"/v1/accounts/{account}/persons/{person}"}),updateCapability:rN({method:"POST",fullPath:"/v1/accounts/{account}/capabilities/{capability}"}),updateExternalAccount:rN({method:"POST",fullPath:"/v1/accounts/{account}/external_accounts/{id}"}),updatePerson:rN({method:"POST",fullPath:"/v1/accounts/{account}/persons/{person}"})}),r$=em.method,rU=em.extend({create:r$({method:"POST",fullPath:"/v1/account_links"})}),rF=em.method,rL=em.extend({create:rF({method:"POST",fullPath:"/v1/account_sessions"})}),rH=em.method,rW=em.extend({create:rH({method:"POST",fullPath:"/v1/apple_pay/domains"}),retrieve:rH({method:"GET",fullPath:"/v1/apple_pay/domains/{domain}"}),list:rH({method:"GET",fullPath:"/v1/apple_pay/domains",methodType:"list"}),del:rH({method:"DELETE",fullPath:"/v1/apple_pay/domains/{domain}"})}),rz=em.method,rB=em.extend({retrieve:rz({method:"GET",fullPath:"/v1/application_fees/{id}"}),list:rz({method:"GET",fullPath:"/v1/application_fees",methodType:"list"}),createRefund:rz({method:"POST",fullPath:"/v1/application_fees/{id}/refunds"}),listRefunds:rz({method:"GET",fullPath:"/v1/application_fees/{id}/refunds",methodType:"list"}),retrieveRefund:rz({method:"GET",fullPath:"/v1/application_fees/{fee}/refunds/{id}"}),updateRefund:rz({method:"POST",fullPath:"/v1/application_fees/{fee}/refunds/{id}"})}),rK=em.method,rV=em.extend({retrieve:rK({method:"GET",fullPath:"/v1/balance"})}),rJ=em.method,rQ=em.extend({retrieve:rJ({method:"GET",fullPath:"/v1/balance_transactions/{id}"}),list:rJ({method:"GET",fullPath:"/v1/balance_transactions",methodType:"list"})}),rX=em.method,rY=em.extend({create:rX({method:"POST",fullPath:"/v1/charges"}),retrieve:rX({method:"GET",fullPath:"/v1/charges/{charge}"}),update:rX({method:"POST",fullPath:"/v1/charges/{charge}"}),list:rX({method:"GET",fullPath:"/v1/charges",methodType:"list"}),capture:rX({method:"POST",fullPath:"/v1/charges/{charge}/capture"}),search:rX({method:"GET",fullPath:"/v1/charges/search",methodType:"search"})}),rZ=em.method,r1=em.extend({retrieve:rZ({method:"GET",fullPath:"/v1/confirmation_tokens/{confirmation_token}"})}),r0=em.method,r2=em.extend({retrieve:r0({method:"GET",fullPath:"/v1/country_specs/{country}"}),list:r0({method:"GET",fullPath:"/v1/country_specs",methodType:"list"})}),r6=em.method,r8=em.extend({create:r6({method:"POST",fullPath:"/v1/coupons"}),retrieve:r6({method:"GET",fullPath:"/v1/coupons/{coupon}"}),update:r6({method:"POST",fullPath:"/v1/coupons/{coupon}"}),list:r6({method:"GET",fullPath:"/v1/coupons",methodType:"list"}),del:r6({method:"DELETE",fullPath:"/v1/coupons/{coupon}"})}),r3=em.method,r5=em.extend({create:r3({method:"POST",fullPath:"/v1/credit_notes"}),retrieve:r3({method:"GET",fullPath:"/v1/credit_notes/{id}"}),update:r3({method:"POST",fullPath:"/v1/credit_notes/{id}"}),list:r3({method:"GET",fullPath:"/v1/credit_notes",methodType:"list"}),listLineItems:r3({method:"GET",fullPath:"/v1/credit_notes/{credit_note}/lines",methodType:"list"}),listPreviewLineItems:r3({method:"GET",fullPath:"/v1/credit_notes/preview/lines",methodType:"list"}),preview:r3({method:"GET",fullPath:"/v1/credit_notes/preview"}),voidCreditNote:r3({method:"POST",fullPath:"/v1/credit_notes/{id}/void"})}),r4=em.method,r9=em.extend({create:r4({method:"POST",fullPath:"/v1/customer_sessions"})}),r7=em.method,ie=em.extend({create:r7({method:"POST",fullPath:"/v1/customers"}),retrieve:r7({method:"GET",fullPath:"/v1/customers/{customer}"}),update:r7({method:"POST",fullPath:"/v1/customers/{customer}"}),list:r7({method:"GET",fullPath:"/v1/customers",methodType:"list"}),del:r7({method:"DELETE",fullPath:"/v1/customers/{customer}"}),createBalanceTransaction:r7({method:"POST",fullPath:"/v1/customers/{customer}/balance_transactions"}),createFundingInstructions:r7({method:"POST",fullPath:"/v1/customers/{customer}/funding_instructions"}),createSource:r7({method:"POST",fullPath:"/v1/customers/{customer}/sources"}),createTaxId:r7({method:"POST",fullPath:"/v1/customers/{customer}/tax_ids"}),deleteDiscount:r7({method:"DELETE",fullPath:"/v1/customers/{customer}/discount"}),deleteSource:r7({method:"DELETE",fullPath:"/v1/customers/{customer}/sources/{id}"}),deleteTaxId:r7({method:"DELETE",fullPath:"/v1/customers/{customer}/tax_ids/{id}"}),listBalanceTransactions:r7({method:"GET",fullPath:"/v1/customers/{customer}/balance_transactions",methodType:"list"}),listCashBalanceTransactions:r7({method:"GET",fullPath:"/v1/customers/{customer}/cash_balance_transactions",methodType:"list"}),listPaymentMethods:r7({method:"GET",fullPath:"/v1/customers/{customer}/payment_methods",methodType:"list"}),listSources:r7({method:"GET",fullPath:"/v1/customers/{customer}/sources",methodType:"list"}),listTaxIds:r7({method:"GET",fullPath:"/v1/customers/{customer}/tax_ids",methodType:"list"}),retrieveBalanceTransaction:r7({method:"GET",fullPath:"/v1/customers/{customer}/balance_transactions/{transaction}"}),retrieveCashBalance:r7({method:"GET",fullPath:"/v1/customers/{customer}/cash_balance"}),retrieveCashBalanceTransaction:r7({method:"GET",fullPath:"/v1/customers/{customer}/cash_balance_transactions/{transaction}"}),retrievePaymentMethod:r7({method:"GET",fullPath:"/v1/customers/{customer}/payment_methods/{payment_method}"}),retrieveSource:r7({method:"GET",fullPath:"/v1/customers/{customer}/sources/{id}"}),retrieveTaxId:r7({method:"GET",fullPath:"/v1/customers/{customer}/tax_ids/{id}"}),search:r7({method:"GET",fullPath:"/v1/customers/search",methodType:"search"}),updateBalanceTransaction:r7({method:"POST",fullPath:"/v1/customers/{customer}/balance_transactions/{transaction}"}),updateCashBalance:r7({method:"POST",fullPath:"/v1/customers/{customer}/cash_balance"}),updateSource:r7({method:"POST",fullPath:"/v1/customers/{customer}/sources/{id}"}),verifySource:r7({method:"POST",fullPath:"/v1/customers/{customer}/sources/{id}/verify"})}),it=em.method,ir=em.extend({retrieve:it({method:"GET",fullPath:"/v1/disputes/{dispute}"}),update:it({method:"POST",fullPath:"/v1/disputes/{dispute}"}),list:it({method:"GET",fullPath:"/v1/disputes",methodType:"list"}),close:it({method:"POST",fullPath:"/v1/disputes/{dispute}/close"})}),ii=em.method,is=em.extend({create:ii({method:"POST",fullPath:"/v1/ephemeral_keys",validator:(e,t)=>{if(!t.headers||!t.headers["Stripe-Version"])throw Error("Passing apiVersion in a separate options hash is required to create an ephemeral key. See https://stripe.com/docs/api/versioning?lang=node")}}),del:ii({method:"DELETE",fullPath:"/v1/ephemeral_keys/{key}"})}),io=em.method,ia=em.extend({retrieve:io({method:"GET",fullPath:"/v1/events/{id}"}),list:io({method:"GET",fullPath:"/v1/events",methodType:"list"})}),il=em.method,ic=em.extend({retrieve:il({method:"GET",fullPath:"/v1/exchange_rates/{rate_id}"}),list:il({method:"GET",fullPath:"/v1/exchange_rates",methodType:"list"})}),iu=em.method,id=em.extend({create:iu({method:"POST",fullPath:"/v1/file_links"}),retrieve:iu({method:"GET",fullPath:"/v1/file_links/{link}"}),update:iu({method:"POST",fullPath:"/v1/file_links/{link}"}),list:iu({method:"GET",fullPath:"/v1/file_links",methodType:"list"})}),ih=(e,t,r)=>{let i=(Math.round(1e16*Math.random())+Math.round(1e16*Math.random())).toString();r["Content-Type"]=`multipart/form-data; boundary=${i}`;let s=new TextEncoder,n=new Uint8Array(0),o=s.encode("\r\n");function a(e){let t=n,r=e instanceof Uint8Array?e:new Uint8Array(s.encode(e));(n=new Uint8Array(t.length+r.length+2)).set(t),n.set(r,t.length),n.set(o,n.length-2)}function l(e){return`"${e.replace(/"|"/g,"%22").replace(/\r\n|\r|\n/g," ")}"`}let c=function(e){let t={},r=(e,i)=>{Object.entries(e).forEach(([e,s])=>{let n=i?`${i}[${e}]`:e;if(function(e){let t=typeof e;return("function"===t||"object"===t)&&!!e}(s)){if(!(s instanceof Uint8Array)&&!Object.prototype.hasOwnProperty.call(s,"data"))return r(s,n);t[n]=s}else t[n]=String(s)})};return r(e,null),t}(t);for(let e in c){if(!Object.prototype.hasOwnProperty.call(c,e))continue;let t=c[e];a(`--${i}`),Object.prototype.hasOwnProperty.call(t,"data")?(a(`Content-Disposition: form-data; name=${l(e)}; filename=${l(t.name||"blob")}`),a(`Content-Type: ${t.type||"application/octet-stream"}`),a(""),a(t.data)):(a(`Content-Disposition: form-data; name=${l(e)}`),a(""),a(t))}return a(`--${i}--`),n},ip=em.method,im=em.extend({create:ip({method:"POST",fullPath:"/v1/files",headers:{"Content-Type":"multipart/form-data"},host:"files.stripe.com"}),retrieve:ip({method:"GET",fullPath:"/v1/files/{file}"}),list:ip({method:"GET",fullPath:"/v1/files",methodType:"list"}),requestDataProcessor:function(e,t,r,i){if(t=t||{},"POST"!==e)return i(null,w(t));this._stripe._platformFunctions.tryBufferData(t).then(t=>i(null,ih(e,t,r))).catch(e=>i(e,null))}}),iy=em.method,ig=em.extend({create:iy({method:"POST",fullPath:"/v1/invoiceitems"}),retrieve:iy({method:"GET",fullPath:"/v1/invoiceitems/{invoiceitem}"}),update:iy({method:"POST",fullPath:"/v1/invoiceitems/{invoiceitem}"}),list:iy({method:"GET",fullPath:"/v1/invoiceitems",methodType:"list"}),del:iy({method:"DELETE",fullPath:"/v1/invoiceitems/{invoiceitem}"})}),iv=em.method,i_=em.extend({retrieve:iv({method:"GET",fullPath:"/v1/invoice_payments/{invoice_payment}"}),list:iv({method:"GET",fullPath:"/v1/invoice_payments",methodType:"list"})}),iP=em.method,ib=em.extend({retrieve:iP({method:"GET",fullPath:"/v1/invoice_rendering_templates/{template}"}),list:iP({method:"GET",fullPath:"/v1/invoice_rendering_templates",methodType:"list"}),archive:iP({method:"POST",fullPath:"/v1/invoice_rendering_templates/{template}/archive"}),unarchive:iP({method:"POST",fullPath:"/v1/invoice_rendering_templates/{template}/unarchive"})}),iT=em.method,iE=em.extend({create:iT({method:"POST",fullPath:"/v1/invoices"}),retrieve:iT({method:"GET",fullPath:"/v1/invoices/{invoice}"}),update:iT({method:"POST",fullPath:"/v1/invoices/{invoice}"}),list:iT({method:"GET",fullPath:"/v1/invoices",methodType:"list"}),del:iT({method:"DELETE",fullPath:"/v1/invoices/{invoice}"}),addLines:iT({method:"POST",fullPath:"/v1/invoices/{invoice}/add_lines"}),attachPayment:iT({method:"POST",fullPath:"/v1/invoices/{invoice}/attach_payment"}),createPreview:iT({method:"POST",fullPath:"/v1/invoices/create_preview"}),finalizeInvoice:iT({method:"POST",fullPath:"/v1/invoices/{invoice}/finalize"}),listLineItems:iT({method:"GET",fullPath:"/v1/invoices/{invoice}/lines",methodType:"list"}),markUncollectible:iT({method:"POST",fullPath:"/v1/invoices/{invoice}/mark_uncollectible"}),pay:iT({method:"POST",fullPath:"/v1/invoices/{invoice}/pay"}),removeLines:iT({method:"POST",fullPath:"/v1/invoices/{invoice}/remove_lines"}),search:iT({method:"GET",fullPath:"/v1/invoices/search",methodType:"search"}),sendInvoice:iT({method:"POST",fullPath:"/v1/invoices/{invoice}/send"}),updateLines:iT({method:"POST",fullPath:"/v1/invoices/{invoice}/update_lines"}),updateLineItem:iT({method:"POST",fullPath:"/v1/invoices/{invoice}/lines/{line_item_id}"}),voidInvoice:iT({method:"POST",fullPath:"/v1/invoices/{invoice}/void"})}),iS=em.method,iw=em.extend({retrieve:iS({method:"GET",fullPath:"/v1/mandates/{mandate}"})}),ix=em.method,iO="connect.stripe.com",iA=em.extend({basePath:"/",authorizeUrl(e,t){e=e||{};let r="oauth/authorize";return(t=t||{}).express&&(r=`express/${r}`),e.response_type||(e.response_type="code"),e.client_id||(e.client_id=this._stripe.getClientId()),e.scope||(e.scope="read_write"),`https://${iO}/${r}?${w(e)}`},token:ix({method:"POST",path:"oauth/token",host:iO}),deauthorize(e,...t){return e.client_id||(e.client_id=this._stripe.getClientId()),ix({method:"POST",path:"oauth/deauthorize",host:iO}).apply(this,[e,...t])}}),ik=em.method,iC=em.extend({create:ik({method:"POST",fullPath:"/v1/payment_intents"}),retrieve:ik({method:"GET",fullPath:"/v1/payment_intents/{intent}"}),update:ik({method:"POST",fullPath:"/v1/payment_intents/{intent}"}),list:ik({method:"GET",fullPath:"/v1/payment_intents",methodType:"list"}),applyCustomerBalance:ik({method:"POST",fullPath:"/v1/payment_intents/{intent}/apply_customer_balance"}),cancel:ik({method:"POST",fullPath:"/v1/payment_intents/{intent}/cancel"}),capture:ik({method:"POST",fullPath:"/v1/payment_intents/{intent}/capture"}),confirm:ik({method:"POST",fullPath:"/v1/payment_intents/{intent}/confirm"}),incrementAuthorization:ik({method:"POST",fullPath:"/v1/payment_intents/{intent}/increment_authorization"}),search:ik({method:"GET",fullPath:"/v1/payment_intents/search",methodType:"search"}),verifyMicrodeposits:ik({method:"POST",fullPath:"/v1/payment_intents/{intent}/verify_microdeposits"})}),iR=em.method,iI=em.extend({create:iR({method:"POST",fullPath:"/v1/payment_links"}),retrieve:iR({method:"GET",fullPath:"/v1/payment_links/{payment_link}"}),update:iR({method:"POST",fullPath:"/v1/payment_links/{payment_link}"}),list:iR({method:"GET",fullPath:"/v1/payment_links",methodType:"list"}),listLineItems:iR({method:"GET",fullPath:"/v1/payment_links/{payment_link}/line_items",methodType:"list"})}),ij=em.method,iG=em.extend({create:ij({method:"POST",fullPath:"/v1/payment_method_configurations"}),retrieve:ij({method:"GET",fullPath:"/v1/payment_method_configurations/{configuration}"}),update:ij({method:"POST",fullPath:"/v1/payment_method_configurations/{configuration}"}),list:ij({method:"GET",fullPath:"/v1/payment_method_configurations",methodType:"list"})}),iM=em.method,iD=em.extend({create:iM({method:"POST",fullPath:"/v1/payment_method_domains"}),retrieve:iM({method:"GET",fullPath:"/v1/payment_method_domains/{payment_method_domain}"}),update:iM({method:"POST",fullPath:"/v1/payment_method_domains/{payment_method_domain}"}),list:iM({method:"GET",fullPath:"/v1/payment_method_domains",methodType:"list"}),validate:iM({method:"POST",fullPath:"/v1/payment_method_domains/{payment_method_domain}/validate"})}),iN=em.method,iq=em.extend({create:iN({method:"POST",fullPath:"/v1/payment_methods"}),retrieve:iN({method:"GET",fullPath:"/v1/payment_methods/{payment_method}"}),update:iN({method:"POST",fullPath:"/v1/payment_methods/{payment_method}"}),list:iN({method:"GET",fullPath:"/v1/payment_methods",methodType:"list"}),attach:iN({method:"POST",fullPath:"/v1/payment_methods/{payment_method}/attach"}),detach:iN({method:"POST",fullPath:"/v1/payment_methods/{payment_method}/detach"})}),i$=em.method,iU=em.extend({create:i$({method:"POST",fullPath:"/v1/payouts"}),retrieve:i$({method:"GET",fullPath:"/v1/payouts/{payout}"}),update:i$({method:"POST",fullPath:"/v1/payouts/{payout}"}),list:i$({method:"GET",fullPath:"/v1/payouts",methodType:"list"}),cancel:i$({method:"POST",fullPath:"/v1/payouts/{payout}/cancel"}),reverse:i$({method:"POST",fullPath:"/v1/payouts/{payout}/reverse"})}),iF=em.method,iL=em.extend({create:iF({method:"POST",fullPath:"/v1/plans"}),retrieve:iF({method:"GET",fullPath:"/v1/plans/{plan}"}),update:iF({method:"POST",fullPath:"/v1/plans/{plan}"}),list:iF({method:"GET",fullPath:"/v1/plans",methodType:"list"}),del:iF({method:"DELETE",fullPath:"/v1/plans/{plan}"})}),iH=em.method,iW=em.extend({create:iH({method:"POST",fullPath:"/v1/prices"}),retrieve:iH({method:"GET",fullPath:"/v1/prices/{price}"}),update:iH({method:"POST",fullPath:"/v1/prices/{price}"}),list:iH({method:"GET",fullPath:"/v1/prices",methodType:"list"}),search:iH({method:"GET",fullPath:"/v1/prices/search",methodType:"search"})}),iz=em.method,iB=em.extend({create:iz({method:"POST",fullPath:"/v1/products"}),retrieve:iz({method:"GET",fullPath:"/v1/products/{id}"}),update:iz({method:"POST",fullPath:"/v1/products/{id}"}),list:iz({method:"GET",fullPath:"/v1/products",methodType:"list"}),del:iz({method:"DELETE",fullPath:"/v1/products/{id}"}),createFeature:iz({method:"POST",fullPath:"/v1/products/{product}/features"}),deleteFeature:iz({method:"DELETE",fullPath:"/v1/products/{product}/features/{id}"}),listFeatures:iz({method:"GET",fullPath:"/v1/products/{product}/features",methodType:"list"}),retrieveFeature:iz({method:"GET",fullPath:"/v1/products/{product}/features/{id}"}),search:iz({method:"GET",fullPath:"/v1/products/search",methodType:"search"})}),iK=em.method,iV=em.extend({create:iK({method:"POST",fullPath:"/v1/promotion_codes"}),retrieve:iK({method:"GET",fullPath:"/v1/promotion_codes/{promotion_code}"}),update:iK({method:"POST",fullPath:"/v1/promotion_codes/{promotion_code}"}),list:iK({method:"GET",fullPath:"/v1/promotion_codes",methodType:"list"})}),iJ=em.method,iQ=em.extend({create:iJ({method:"POST",fullPath:"/v1/quotes"}),retrieve:iJ({method:"GET",fullPath:"/v1/quotes/{quote}"}),update:iJ({method:"POST",fullPath:"/v1/quotes/{quote}"}),list:iJ({method:"GET",fullPath:"/v1/quotes",methodType:"list"}),accept:iJ({method:"POST",fullPath:"/v1/quotes/{quote}/accept"}),cancel:iJ({method:"POST",fullPath:"/v1/quotes/{quote}/cancel"}),finalizeQuote:iJ({method:"POST",fullPath:"/v1/quotes/{quote}/finalize"}),listComputedUpfrontLineItems:iJ({method:"GET",fullPath:"/v1/quotes/{quote}/computed_upfront_line_items",methodType:"list"}),listLineItems:iJ({method:"GET",fullPath:"/v1/quotes/{quote}/line_items",methodType:"list"}),pdf:iJ({method:"GET",fullPath:"/v1/quotes/{quote}/pdf",host:"files.stripe.com",streaming:!0})}),iX=em.method,iY=em.extend({create:iX({method:"POST",fullPath:"/v1/refunds"}),retrieve:iX({method:"GET",fullPath:"/v1/refunds/{refund}"}),update:iX({method:"POST",fullPath:"/v1/refunds/{refund}"}),list:iX({method:"GET",fullPath:"/v1/refunds",methodType:"list"}),cancel:iX({method:"POST",fullPath:"/v1/refunds/{refund}/cancel"})}),iZ=em.method,i1=em.extend({retrieve:iZ({method:"GET",fullPath:"/v1/reviews/{review}"}),list:iZ({method:"GET",fullPath:"/v1/reviews",methodType:"list"}),approve:iZ({method:"POST",fullPath:"/v1/reviews/{review}/approve"})}),i0=em.method,i2=em.extend({list:i0({method:"GET",fullPath:"/v1/setup_attempts",methodType:"list"})}),i6=em.method,i8=em.extend({create:i6({method:"POST",fullPath:"/v1/setup_intents"}),retrieve:i6({method:"GET",fullPath:"/v1/setup_intents/{intent}"}),update:i6({method:"POST",fullPath:"/v1/setup_intents/{intent}"}),list:i6({method:"GET",fullPath:"/v1/setup_intents",methodType:"list"}),cancel:i6({method:"POST",fullPath:"/v1/setup_intents/{intent}/cancel"}),confirm:i6({method:"POST",fullPath:"/v1/setup_intents/{intent}/confirm"}),verifyMicrodeposits:i6({method:"POST",fullPath:"/v1/setup_intents/{intent}/verify_microdeposits"})}),i3=em.method,i5=em.extend({create:i3({method:"POST",fullPath:"/v1/shipping_rates"}),retrieve:i3({method:"GET",fullPath:"/v1/shipping_rates/{shipping_rate_token}"}),update:i3({method:"POST",fullPath:"/v1/shipping_rates/{shipping_rate_token}"}),list:i3({method:"GET",fullPath:"/v1/shipping_rates",methodType:"list"})}),i4=em.method,i9=em.extend({create:i4({method:"POST",fullPath:"/v1/sources"}),retrieve:i4({method:"GET",fullPath:"/v1/sources/{source}"}),update:i4({method:"POST",fullPath:"/v1/sources/{source}"}),listSourceTransactions:i4({method:"GET",fullPath:"/v1/sources/{source}/source_transactions",methodType:"list"}),verify:i4({method:"POST",fullPath:"/v1/sources/{source}/verify"})}),i7=em.method,se=em.extend({create:i7({method:"POST",fullPath:"/v1/subscription_items"}),retrieve:i7({method:"GET",fullPath:"/v1/subscription_items/{item}"}),update:i7({method:"POST",fullPath:"/v1/subscription_items/{item}"}),list:i7({method:"GET",fullPath:"/v1/subscription_items",methodType:"list"}),del:i7({method:"DELETE",fullPath:"/v1/subscription_items/{item}"})}),st=em.method,sr=em.extend({create:st({method:"POST",fullPath:"/v1/subscription_schedules"}),retrieve:st({method:"GET",fullPath:"/v1/subscription_schedules/{schedule}"}),update:st({method:"POST",fullPath:"/v1/subscription_schedules/{schedule}"}),list:st({method:"GET",fullPath:"/v1/subscription_schedules",methodType:"list"}),cancel:st({method:"POST",fullPath:"/v1/subscription_schedules/{schedule}/cancel"}),release:st({method:"POST",fullPath:"/v1/subscription_schedules/{schedule}/release"})}),si=em.method,ss=em.extend({create:si({method:"POST",fullPath:"/v1/subscriptions"}),retrieve:si({method:"GET",fullPath:"/v1/subscriptions/{subscription_exposed_id}"}),update:si({method:"POST",fullPath:"/v1/subscriptions/{subscription_exposed_id}"}),list:si({method:"GET",fullPath:"/v1/subscriptions",methodType:"list"}),cancel:si({method:"DELETE",fullPath:"/v1/subscriptions/{subscription_exposed_id}"}),deleteDiscount:si({method:"DELETE",fullPath:"/v1/subscriptions/{subscription_exposed_id}/discount"}),migrate:si({method:"POST",fullPath:"/v1/subscriptions/{subscription}/migrate"}),resume:si({method:"POST",fullPath:"/v1/subscriptions/{subscription}/resume"}),search:si({method:"GET",fullPath:"/v1/subscriptions/search",methodType:"search"})}),sn=em.method,so=em.extend({retrieve:sn({method:"GET",fullPath:"/v1/tax_codes/{id}"}),list:sn({method:"GET",fullPath:"/v1/tax_codes",methodType:"list"})}),sa=em.method,sl=em.extend({create:sa({method:"POST",fullPath:"/v1/tax_ids"}),retrieve:sa({method:"GET",fullPath:"/v1/tax_ids/{id}"}),list:sa({method:"GET",fullPath:"/v1/tax_ids",methodType:"list"}),del:sa({method:"DELETE",fullPath:"/v1/tax_ids/{id}"})}),sc=em.method,su=em.extend({create:sc({method:"POST",fullPath:"/v1/tax_rates"}),retrieve:sc({method:"GET",fullPath:"/v1/tax_rates/{tax_rate}"}),update:sc({method:"POST",fullPath:"/v1/tax_rates/{tax_rate}"}),list:sc({method:"GET",fullPath:"/v1/tax_rates",methodType:"list"})}),sd=em.method,sh=em.extend({create:sd({method:"POST",fullPath:"/v1/tokens"}),retrieve:sd({method:"GET",fullPath:"/v1/tokens/{token}"})}),sp=em.method,sm=em.extend({create:sp({method:"POST",fullPath:"/v1/topups"}),retrieve:sp({method:"GET",fullPath:"/v1/topups/{topup}"}),update:sp({method:"POST",fullPath:"/v1/topups/{topup}"}),list:sp({method:"GET",fullPath:"/v1/topups",methodType:"list"}),cancel:sp({method:"POST",fullPath:"/v1/topups/{topup}/cancel"})}),sf=em.method,sy=em.extend({create:sf({method:"POST",fullPath:"/v1/transfers"}),retrieve:sf({method:"GET",fullPath:"/v1/transfers/{transfer}"}),update:sf({method:"POST",fullPath:"/v1/transfers/{transfer}"}),list:sf({method:"GET",fullPath:"/v1/transfers",methodType:"list"}),createReversal:sf({method:"POST",fullPath:"/v1/transfers/{id}/reversals"}),listReversals:sf({method:"GET",fullPath:"/v1/transfers/{id}/reversals",methodType:"list"}),retrieveReversal:sf({method:"GET",fullPath:"/v1/transfers/{transfer}/reversals/{id}"}),updateReversal:sf({method:"POST",fullPath:"/v1/transfers/{transfer}/reversals/{id}"})}),sg=em.method,sv=em.extend({create:sg({method:"POST",fullPath:"/v1/webhook_endpoints"}),retrieve:sg({method:"GET",fullPath:"/v1/webhook_endpoints/{webhook_endpoint}"}),update:sg({method:"POST",fullPath:"/v1/webhook_endpoints/{webhook_endpoint}"}),list:sg({method:"GET",fullPath:"/v1/webhook_endpoints",methodType:"list"}),del:sg({method:"DELETE",fullPath:"/v1/webhook_endpoints/{webhook_endpoint}"})}),s_=ey("apps",{Secrets:rr}),sP=ey("billing",{Alerts:eT,CreditBalanceSummary:eW,CreditBalanceTransactions:eB,CreditGrants:eV,MeterEventAdjustments:tu,MeterEvents:tv,Meters:tT}),sb=ey("billingPortal",{Configurations:eD,Sessions:rs}),sT=ey("checkout",{Sessions:ro}),sE=ey("climate",{Orders:tS,Products:tU,Suppliers:rh}),sS=ey("entitlements",{ActiveEntitlements:eP,Features:te}),sw=ey("financialConnections",{Accounts:ev,Sessions:rl,Transactions:rT}),sx=ey("forwarding",{Requests:t9}),sO=ey("identity",{VerificationReports:rG,VerificationSessions:rD}),sA=ey("issuing",{Authorizations:ex,Cardholders:eC,Cards:eG,Disputes:e2,PersonalizationDesigns:tD,PhysicalBundles:tq,Tokens:ry,Transactions:rS}),sk=ey("radar",{EarlyFraudWarnings:e8,ValueListItems:rC,ValueLists:rI}),sC=ey("reporting",{ReportRuns:t8,ReportTypes:t5}),sR=ey("sigma",{ScheduledQueryRuns:re}),sI=ey("tax",{Calculations:eA,Registrations:t2,Settings:ru,Transactions:rx}),sj=ey("terminal",{Configurations:eq,ConnectionTokens:eL,Locations:tl,Readers:tW}),sG=ey("testHelpers",{ConfirmationTokens:eU,Customers:eY,Refunds:t1,TestClocks:rm,Issuing:ey("issuing",{Authorizations:eS,Cards:eI,PersonalizationDesigns:tG,Transactions:rP}),Terminal:ey("terminal",{Readers:tL}),Treasury:ey("treasury",{InboundTransfers:ts,OutboundPayments:tx,OutboundTransfers:tC,ReceivedCredits:tB,ReceivedDebits:tQ})}),sM=ey("treasury",{CreditReversals:eQ,DebitReversals:e1,FinancialAccounts:tr,InboundTransfers:to,OutboundPayments:tA,OutboundTransfers:tI,ReceivedCredits:tV,ReceivedDebits:tY,TransactionEntries:rv,Transactions:rA}),sD=ey("v2",{Billing:ey("billing",{MeterEventAdjustments:th,MeterEventSession:tm,MeterEventStream:ty,MeterEvents:tP}),Core:ey("core",{EventDestinations:e5,Events:e9})}),sN="api.stripe.com",sq="/v1/",s$="2025-06-30.basil",sU=["name","version","url","partner_id"],sF=["authenticator","apiVersion","typescript","maxNetworkRetries","httpAgent","httpClient","timeout","host","port","protocol","telemetry","appInfo","stripeAccount","stripeContext"],sL=e=>new eo(e,em.MAX_BUFFERED_REQUEST_METRICS),sH=function(e,t=sL){function r(s,n={}){if(!(this instanceof r))return new r(s,n);let o=this._getPropsFromConfig(n);this._platformFunctions=e,Object.defineProperty(this,"_emitter",{value:this._platformFunctions.createEmitter(),enumerable:!1,configurable:!1,writable:!1}),this.VERSION=r.PACKAGE_VERSION,this.on=this._emitter.on.bind(this._emitter),this.once=this._emitter.once.bind(this._emitter),this.off=this._emitter.removeListener.bind(this._emitter);let a=o.httpAgent||null;this._api={host:o.host||sN,port:o.port||"443",protocol:o.protocol||"https",basePath:sq,version:o.apiVersion||s$,timeout:I("timeout",o.timeout,8e4),maxNetworkRetries:I("maxNetworkRetries",o.maxNetworkRetries,2),agent:a,httpClient:o.httpClient||(a?this._platformFunctions.createNodeHttpClient(a):this._platformFunctions.createDefaultHttpClient()),dev:!1,stripeAccount:o.stripeAccount||null,stripeContext:o.stripeContext||null};let l=o.typescript||!1;l!==r.USER_AGENT.typescript&&(r.USER_AGENT.typescript=l),o.appInfo&&this._setAppInfo(o.appInfo),this._prepResources(),this._setAuthenticator(s,o.authenticator),this.errors=i,this.webhooks=r.webhooks,this._prevRequestMetrics=[],this._enableTelemetry=!1!==o.telemetry,this._requestSender=t(this),this.StripeResource=r.StripeResource}return r.PACKAGE_VERSION="18.3.0",r.USER_AGENT=Object.assign({bindings_version:r.PACKAGE_VERSION,lang:"node",publisher:"stripe",uname:null,typescript:!1},"undefined"==typeof process?{}:{lang_version:process.version,platform:process.platform}),r.StripeResource=em,r.resources=s,r.HttpClient=m,r.HttpClientResponse=f,r.CryptoProvider=a,r.webhooks=function(e){let t={DEFAULT_TOLERANCE:300,signature:null,constructEvent(e,r,i,s,n,o){try{if(!this.signature)throw Error("ERR: missing signature helper, unable to verify");this.signature.verifyHeader(e,r,i,s||t.DEFAULT_TOLERANCE,n,o)}catch(e){throw e instanceof l&&(e.message+="\nUse `await constructEventAsync(...)` instead of `constructEvent(...)`"),e}return e instanceof Uint8Array?JSON.parse(new TextDecoder("utf8").decode(e)):JSON.parse(e)},async constructEventAsync(e,r,i,s,n,o){if(!this.signature)throw Error("ERR: missing signature helper, unable to verify");return await this.signature.verifyHeaderAsync(e,r,i,s||t.DEFAULT_TOLERANCE,n,o),e instanceof Uint8Array?JSON.parse(new TextDecoder("utf8").decode(e)):JSON.parse(e)},generateTestHeaderString:function(e){let t=c(e),r=t.signature||t.cryptoProvider.computeHMACSignature(t.payloadString,t.secret);return t.generateHeaderString(r)},generateTestHeaderStringAsync:async function(e){let t=c(e),r=t.signature||await t.cryptoProvider.computeHMACSignatureAsync(t.payloadString,t.secret);return t.generateHeaderString(r)}},r={EXPECTED_SCHEME:"v1",verifyHeader(e,t,r,o,l,c){let{decodedHeader:u,decodedPayload:d,details:h,suspectPayloadType:p}=s(e,t,this.EXPECTED_SCHEME),m=/\s/.test(r),f=(l=l||a()).computeHMACSignature(i(d,h),r);return n(d,u,h,f,o,p,m,c),!0},async verifyHeaderAsync(e,t,r,o,l,c){let{decodedHeader:u,decodedPayload:d,details:h,suspectPayloadType:p}=s(e,t,this.EXPECTED_SCHEME),m=/\s/.test(r);l=l||a();let f=await l.computeHMACSignatureAsync(i(d,h),r);return n(d,u,h,f,o,p,m,c)}};function i(e,t){return`${t.timestamp}.${e}`}function s(e,t,r){if(!e)throw new Y(t,e,{message:"No webhook payload was provided."});let i="string"!=typeof e&&!(e instanceof Uint8Array),s=new TextDecoder("utf8"),n=e instanceof Uint8Array?s.decode(e):e;if(Array.isArray(t))throw Error("Unexpected: An array was passed as a header, which should not be possible for the stripe-signature header.");if(null==t||""==t)throw new Y(t,e,{message:"No stripe-signature header value was provided."});let o=t instanceof Uint8Array?s.decode(t):t,a="string"!=typeof o?null:o.split(",").reduce((e,t)=>{let i=t.split("=");return"t"===i[0]&&(e.timestamp=parseInt(i[1],10)),i[0]===r&&e.signatures.push(i[1]),e},{timestamp:-1,signatures:[]});if(!a||-1===a.timestamp)throw new Y(o,n,{message:"Unable to extract timestamp and signatures from header"});if(!a.signatures.length)throw new Y(o,n,{message:"No signatures found with expected scheme"});return{decodedPayload:n,decodedHeader:o,details:a,suspectPayloadType:i}}function n(t,r,i,s,n,o,a,l){let c=!!i.signatures.filter(e.secureCompare.bind(e,s)).length,u="\nLearn more about webhook signing and explore webhook integration examples for various frameworks at https://docs.stripe.com/webhooks/signature",d=a?"\n\nNote: The provided signing secret contains whitespace. This often indicates an extra newline or space is in the value":"";if(!c){if(o)throw new Y(r,t,{message:"Webhook payload must be provided as a string or a Buffer (https://nodejs.org/api/buffer.html) instance representing the _raw_ request body.Payload was provided as a parsed JavaScript object instead. \nSignature verification is impossible without access to the original signed material. \n"+u+"\n"+d});throw new Y(r,t,{message:"No signatures found matching the expected signature for payload. Are you passing the raw request body you received from Stripe? \n If a webhook request is being forwarded by a third-party tool, ensure that the exact request body, including JSON formatting and new line style, is preserved.\n"+u+"\n"+d})}let h=Math.floor(("number"==typeof l?l:Date.now())/1e3)-i.timestamp;if(n>0&&h>n)throw new Y(r,t,{message:"Timestamp outside the tolerance zone"});return!0}let o=null;function a(){return o||(o=e.createDefaultCryptoProvider()),o}function c(e){if(!e)throw new W({message:"Options are required"});let t=Math.floor(e.timestamp)||Math.floor(Date.now()/1e3),i=e.scheme||r.EXPECTED_SCHEME,s=e.cryptoProvider||a(),n=`${t}.${e.payload}`;return Object.assign(Object.assign({},e),{timestamp:t,scheme:i,cryptoProvider:s,payloadString:n,generateHeaderString:e=>`t=${t},${i}=${e}`})}return t.signature=r,t}(e),r.errors=i,r.createNodeHttpClient=e.createNodeHttpClient,r.createFetchHttpClient=e.createFetchHttpClient,r.createNodeCryptoProvider=e.createNodeCryptoProvider,r.createSubtleCryptoProvider=e.createSubtleCryptoProvider,r.prototype={_appInfo:void 0,on:null,off:null,once:null,VERSION:null,StripeResource:null,webhooks:null,errors:null,_api:null,_prevRequestMetrics:null,_emitter:null,_enableTelemetry:null,_requestSender:null,_platformFunctions:null,rawRequest(e,t,r,i){return this._requestSender._rawRequest(e,t,r,i)},_setAuthenticator(e,t){if(e&&t)throw Error("Can't specify both apiKey and authenticator");if(!e&&!t)throw Error("Neither apiKey nor config.authenticator provided");this._authenticator=e?j(e):t},_setAppInfo(e){if(e&&"object"!=typeof e)throw Error("AppInfo must be an object.");if(e&&!e.name)throw Error("AppInfo.name is required");e=e||{},this._appInfo=sU.reduce((t,r)=>("string"==typeof e[r]&&((t=t||{})[r]=e[r]),t),{})},_setApiField(e,t){this._api[e]=t},getApiField(e){return this._api[e]},setClientId(e){this._clientId=e},getClientId(){return this._clientId},getConstant:e=>{switch(e){case"DEFAULT_HOST":return sN;case"DEFAULT_PORT":return"443";case"DEFAULT_BASE_PATH":return sq;case"DEFAULT_API_VERSION":return s$;case"DEFAULT_TIMEOUT":return 8e4;case"MAX_NETWORK_RETRY_DELAY_SEC":return 5;case"INITIAL_NETWORK_RETRY_DELAY_SEC":return .5}return r[e]},getMaxNetworkRetries(){return this.getApiField("maxNetworkRetries")},_setApiNumberField(e,t,r){let i=I(e,t,r);this._setApiField(e,i)},getMaxNetworkRetryDelay:()=>5,getInitialNetworkRetryDelay:()=>.5,getClientUserAgent(e){return this.getClientUserAgentSeeded(r.USER_AGENT,e)},getClientUserAgentSeeded(e,t){this._platformFunctions.getUname().then(r=>{var i;let s={};for(let t in e)Object.prototype.hasOwnProperty.call(e,t)&&(s[t]=encodeURIComponent(null!==(i=e[t])&&void 0!==i?i:"null"));s.uname=encodeURIComponent(r||"UNKNOWN");let n=this.getApiField("httpClient");n&&(s.httplib=encodeURIComponent(n.getClientName())),this._appInfo&&(s.application=this._appInfo),t(JSON.stringify(s))})},getAppInfoAsString(){if(!this._appInfo)return"";let e=this._appInfo.name;return this._appInfo.version&&(e+=`/${this._appInfo.version}`),this._appInfo.url&&(e+=` (${this._appInfo.url})`),e},getTelemetryEnabled(){return this._enableTelemetry},_prepResources(){for(let e in s)Object.prototype.hasOwnProperty.call(s,e)&&(this["OAuth"===e?"oauth":e[0].toLowerCase()+e.substring(1)]=new s[e](this))},_getPropsFromConfig(e){if(!e)return{};let t="string"==typeof e;if(!(e===Object(e)&&!Array.isArray(e))&&!t)throw Error("Config must either be an object or a string");if(t)return{apiVersion:e};if(Object.keys(e).filter(e=>!sF.includes(e)).length>0)throw Error(`Config object may only contain the following: ${sF.join(", ")}`);return e},parseThinEvent(e,t,r,i,s,n){return this.webhooks.constructEvent(e,t,r,i,s,n)}},r}(new en)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[948,212,972],()=>r(36556));module.exports=i})();